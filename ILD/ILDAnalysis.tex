
\section{Heavy quark phenomenology and New Physics}
The mass od the top quark is comparable to the electroweak symmetry breaking scale. 
This fact makes top quark a subject of many New Physics theories. 
The measurements of the bottom quark properties, a partner of the top quark, have revealed a tension with \sm\ predictions. 
Many \bsm\ theories can modify heavy quark properties, therefore, precise measurements of heavy quark couplings are required for indirect searches of new particles and discrimination between various theories. 

This section concentrates on the electroweak production of the top and bottom quarks pairs, corresponding observables, heavy quark production at linear colliders and possible influence of New Physics.
Other sources of the electroweak production as e.g. single top are not covered in the thesis. 

%the higgs is tightly connected to the top quark via coupling that is proportional to the top mass
%The bottom quark is in the same doublet as top

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Description of the heavy quark production}
%First, one needs to define the most convenient parametrization of coupling or form factors of interest, and then express the observable quantities in terms of defined form factors. 
Electroweak production of the fermion pairs proceeds through the $f\bar{f}X$ vertex, where $X$ represents neutral vector bosons, photon or $Z^0$ boson.  The current at $f\bar{f}X$ vertex can be expressed via form factors $F$ as 
\begin{equation}
\Gamma^{f\bar{f}X}_\mu (k^2,q,\bar{q}) = ie\{ \gamma_\mu (F^X_{1V}(k^2) + \gamma^5 F^X_{1A}(k^2)) - \frac{\sigma_{\mu\nu}(q-\bar{q})^\nu}{2m_f}(iF^X_{2V}(k^2) + \gamma^5 F^X_{2A}(k^2)) \},
\end{equation}
where $k^2= (q+\bar{q})^2$ is the four momentum squared of the exchanged vector boson, $q$ and $\bar{q}$ are the four vectors of the fermion $f$ and antifermion $\bar{f}$ and $m_f$ is the fermion mass. Further, $\gamma_\mu$ and $\gamma_5$ are the Dirac matrices, and $\sigma_{\mu\nu} = i/2(\gamma_\mu\gamma_\nu - \gamma_\nu\gamma_\mu)$.

The \sm\ values of the form factors $F$ are the following:
\begin{equation}
F^{f\gamma}_{1V} = Q^{f}, \ F^{f\gamma}_{1A} = 0, \ F^{fZ}_{1V} = \frac{I^f - 2Q^f\sin^2\theta_W}{2\cos\theta_W\sin\theta_W}, \ F^{fZ}_{1A} = - \frac{I^f}{2\cos\theta_W\sin\theta_W},
\label{formula:SMformFactors_3}
\end{equation}
and all $F_2$ factor are zero. In the expression \ref{formula:SMformFactors_3} $I^f$ is the weak isospin number, $I^t = 1/2$ for top and $I^b = -1/2$ for bottom quark and $Q^f$ is an electric charge, $Q^t = 2/3$ and $Q^b = -1/3$.

The form factors are related to fermion couplings with left and right-handed helicity to $Z^0$ boson:
\begin{equation}
g_L^Z = F_{1V}^Z - F_{1A}^Z, \  g_R^Z = F_{1V}^Z + F_{1A}^Z, 
\label{formula:EWcouplings_3}
\end{equation}
the same relations are applied to the corresponding photon couplings $g^\gamma_L$.
%At the tree level, the \sm\ differential cross for the production
%of a fermion $f$ pair in $e^+e^-\to f\bar{f}$ at center-of-mass energy $\sqrt[]{s}$ can be written as

In case of the polarized beams, the fermion form factors can be expressed in terms of the helicity of the initial electrons~\cite{bib:Schmidt}:
\begin{eqnarray}
\mathcal{F}^L_{ij} = - F^\gamma_{ij} +  \frac{-1/2 + \sin^2\theta_W}{\cos\theta_W\sin\theta_W}\frac{s}{s-M^2_Z+i\Gamma_ZM_Z}F^Z_{ij},\\
\mathcal{F}^R_{ij} = - F^\gamma_{ij} +  \frac{\sin^2\theta_W}{\cos\theta_W\sin\theta_W}\frac{s}{s-M^2_Z+i\Gamma_ZM_Z}F^Z_{ij}    
\end{eqnarray}

where $i=1,2$ and $j=V,A$, $M_Z$ and $\Gamma_Z$ are the $Z^0$ boson mass and width, respectively.

The key expression for the studies is the differential cross section of $f\bar{f}$ production for electron beam polarization $I=L,R$, expressed via the defined form factors:

\begin{multline}
% \frac{\pi\alpha^2 N_c\beta}{s}
\label{formula:DiffSigma_3}
\frac{d\sigma^I}{d\cos\theta} = \frac{3}{4} \mathcal{A} N_c \beta[ (1+\cos^2\theta) [(\mF_{1V}+\mF_{2V})^2+(\beta \mF_{1A})^2] - \\-4 \cos\theta (\mF_{1A}+\mF_{2V})\beta \mF_{1A} +\\+ \sin^2\theta [\gamma ^{-2} (\mF_{1V} +\gamma^2 \mF_{2V})^2] ]
\end{multline}
where $\mathcal{A} = 4\pi\alpha^2/3s$ with $\alpha$ as the electromagnetic running coupling, $N_c$ is a number of quark colors, $\beta$ and $\gamma$ are the velocity and the Lorentz factor of the produced fermion, respectively. 

One can derive from (\ref{formula:DiffSigma_3}) the total cross section, a common observable, which can be expressed as
%2\frac{4\pi\alpha^2}{3s}N_c\beta
\begin{equation}
\label{formula:TotalSigma_3}
\sigma_I = 2\mathcal{A}N_c\beta[(1+\frac{1}{2}\gamma^{-2})(\mathcal{F}^I_{1V})^2 + (\beta\mathcal{F}^I_{1A})^2+3\mathcal{F}^I_{1V}\mathcal{F}^I_{2V}+(1+\frac{1}{2}\gamma^{2})(\mathcal{F}^I_{2V})^2],
\end{equation}
The term $\beta \mF_{1A}$ describes the reduced sensitivity to the axial form factors near the $f\bar{f}$ production threshold. 

The beams in the $e^+e^-$ colliders, like the ILC, will not be fully polarized, therefore one should take into account the electron beam polarization degree $\mathcal{P}$ and positron polarization degree $\mathcal{P}'$, therefore, the expression for the total cross section is
\begin{equation}
\sigma_{\mathcal{P}\mathcal{P}'} = \frac{1}{4}[(1-\mathcal{P}\mathcal{P}')(\sigma_{LR}+\sigma_{RL} ) + (\mathcal{P} - \mathcal{P}')(\sigma_{RL} - \sigma_{LR})],
\end{equation}
where the indices $L$ and $R$ indicate full polarization of the incoming electron and positron beams of left-handed or right-handed helicity, respectively.

Another typical observable is the forward-backward asymmetry, which is defined as
\begin{equation}
A_{FB}^I = \mp \mathcal{A} N_c \frac{3\beta\mathcal{F}^I_{1A}(\mathcal{F}^I_{1V} + \mathcal{F}^I_{2V})}{\sigma^I}.
\label{formula:AfbForm_3}
\end{equation}

This observable has a large sensitivity to the axial form factor $\mathcal{F}^I_{1A}$, therefore it is crucial to measure $A_{fb}^I$ precisely to reduce uncertainty on the corresponding form factors.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Observables of interest}
The conventional approach used to estimate the couplings or form factors of the fermion $f$ to the vector bosons $\gamma /Z^0$ is to measure the total cross section $\sigma_I$ and forward-backward asymmetry \afb.

The total cross section can be measured knowing the number of accepted events $N$, selection efficiency $\epsilon$ and integrated luminosity $\mathcal{L}_I$
\begin{equation}
\sigma_I = \frac{N}{\epsilon \mathcal{L}_I}.
\label{formula:Xsection_3}
\end{equation}
The corresponding uncertainty on the cross section is determined by the knowledge of the luminosity of the machine, the statistics of the signal: 
\begin{equation}
	(\frac{\delta \sigma_I}{\sigma_I})^2 = (\frac{\delta N}{N})^2 + (\frac{\delta \mathcal{L}_I}{\mathcal{L}_I})^2.
\end{equation}
The forward-backward asymmetry is an observable, which counts the difference between the number of events in the forward region and backward regions:
\begin{equation}
A_{FB} = \frac{\sigma(cos\theta > 0) - \sigma(cos\theta < 0)}{\sigma(cos\theta > 0) + \sigma(cos\theta < 0)}.
\end{equation}
The statistical uncertainty on the \afb\ as for a simple counting experiment is given by 
\begin{equation}
\delta A_{FB} = \sqrt{\frac{1-A_{FB}^2}{N}},
\end{equation}
where $N$ is the number of reconstructed events. 

%For the proper \afb\ measurement,  it is crucial to measure the charge of the quarks with a high purity. 
%single top
%Another source of top quark production at linear colliders is the single top process. %which is shown in Fig. \ref{fig:singletop_3}. 
%This process allows top quark production at 250\,GeV center-of-mass energy, but the study of the single top production is not included in the thesis. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{New Physics influence}
%The heavy quarks and the Higgs boson are often subject of \bsm\ deviations.
%For example, supersymmetric extensions of the \sm\ predict different set of Higgs couplings to the up type and down type quarks. 

The extradimentional extensions of the \sm\ like Randall-Sundrum models are able to provide an explanation to the mass hierarchy, and have additional weak boson excitations. 
These theories have additional weak bosons $Z'$ or $W'$ with a mixing to the \sm\ bosons, which can modify the electroweak couplings of the heavy quarks. 
The possible compositness of heavy quarks can also leave an imprint on the their electroweak couplings, which is described by various technicolor theories.
These models can have different impact on the left-handed or right handed couplings on the electroweak couplings of the heavy quarks. 

\begin{figure}[h]
	{\centering
		\includegraphics[clip, trim=4cm 7cm 2cm 10cm, width=0.95\textwidth]{ILD/graphics/plot.pdf}
		\caption{\sl Predictions of several models that incorporate Randall-Sundrum (RS) models and/or compositeness or Little Higgs models on the deviations of the left- and right-handed couplings of the $t$~quark to the $Z^0$ boson. The ellipse in the frame in the upper right corner indicates the precision that can be expected for the ILC running at a center-of-mass energy of $\sqrt[]{s} = 500\,GeV$ after having accumulated ${\mathcal L}=500\,fb^{-1}$ of integrated luminosity shared equally between the beam polarizations $P(e^-),\,P(e^+) =\pm0.8,\mp0.3$. The original version of this figure can be found in~\cite{bib:ILCTOP}.}
		\label{fig:DeviationsTop}
	}
\end{figure}

The relative deviations of the left-handed and right-handed couplings of the top quark are predicted by various BSM theories are shown in Fig.~\ref{fig:DeviationsTop}.
A precise measurement of the top coupling allows for identification of the particular BSM theory.  
The experiments with polarized beams have an advantage of detection of sign flip of the right-handed coupling $g_R^Z$, which can be produced by the Randall-Sundrum models with $Z^0$-$Z'$ mixing~\cite{bib:RSTOP}.
%
%Many \bsm\ models predict deviations on the heavy quark couplings to the Higgs and weak bosons.


%\input{ILD/graphics/deviations}
%Supersymmetric models  -  have different set of Higgs couplings to the up and down type quarks.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Status of the measurements and simulation studies}
%mass measurements

\subsubsection{Measurements at LEP and SLC}
The electron-positron colliders have a large production cross section of $e^+e^- \to q\bar{q}$ process mediated by $Z^0$ boson or a virtual photon. The total cross sections of various \sm\ processes for the $e^+e^-$ machines are shown in Fig.~\ref{fig:LCcrosssection}.

The circular LEP~I and the linear SLC colliders operated at the $Z^0$ pole, where the $e^+e^-$ cross section is maximal, benefiting from significantly increased event rate. 
The measurements resulted in extremely precise b-quark fraction $R_b$ and the b-quark forward-backward asymmetry $A_{FB}^b$ measurements. 
The measured $R_b$ value, which is the ratio of b-quark cross section over total hadronic cross section, has full compatibility with the \sm\ prediction. 
On the other hand, the measured b-quark forward-backward asymmetry $A_{FB}^b$  value at LEP has 2.5\,$\sigma$ tension with the recent electroweak fit predictions~\cite{bib:AfbSMFit}.
The measurement of the $A_{FB}^b$ value at the SLC have 27\% higher uncertainty than the LEP results~\cite{bib:SLC}.

The measurements outside $Z^0$ pole were done by the LEP~II collider, which collected the most integrated luminosity at around 190\,GeV energy, at the $W^\pm$-pair production threshold. 
The measured $A_{FB}^b$ at this center-of-mass energy is within 2\,$\sigma$ from the tree level \sm\ prediction.

The precise determination of the $Zb\bar{b}$ vertex at LEP~I experiments allowed to put constraints on the top quark and Higgs boson masses~\cite{bib:LEPTOP}.
%$A_{fb}^b(\sqrt[]{s} = 190.7\,\text{GeV})=0.51\pm0.058$
%Unfortunately, the beam energies of LEP~II and SLC was not high enough to produce single top or top quark pairs, therefore, the precise determination of the top electroweak couplings is left for the future electron-positron machines.

\subsubsection{LHC and TeVatron measurements}
The initial state at hadron colliders priviledges the production of the top quark pairs through the strong interaction via high cross section $gg\to t\bar{t}$ or $q\bar{q}\to t\bar{t}$ processes.
Therefore, the hadron machines can measure the top mass and strong couplings of the top quark with a high precision. 

The TeVatron, which has proton-antiproton beams, can produce single top via $q\bar{q}' \to W^\pm \to t\bar{b}$ process at a higher rate than proton-proton machines. 
This process involve $tbW$ vertex and therefore, its total cross section depends on the weak couplings of the top quark. 
The measurement of single top cross section at TeVatron is found to be consistent with the \sm\ predictions~\cite{bib:TeVstop} with about 16\% uncertainty.

The forward-backward asymmetry at hadron colliders for strong interaction vertex $gt\bar{t}$ has been measured to be consistent with the \sm\ expectations~\cite{bib:TeVAfb}. 

To measure the electroweak couplings of the top quark at hadron colliders, the associate production of top quark pair with $Z^0$ or $W^\pm$ bosons is required, which has lower cross section, than the direct electroweak production process.
Study of the $t\bar{t}Z^0$ process has been done at the LHC experiments using Run I data with $\sqrt{s} = 8$\,TeV shows compatible rates of the signal process with the \sm, but more statistics is required to measure the cross section precisely~\cite{bib:CMSttz2014}. The cross section fit results for the $t\bar{t}Z^0$ and $t\bar{t}W^\pm$ processes are shown in Fig~\ref{fig:LHCTopTopZ_3}.
Including the Run~II data of the LHC with a higher center-of-mass energy will significantly improve $t\bar{t}Z^0$ measurement.
%Main channel of the top quark production is gluons
\begin{figure}[h]
	{\centering
		\includegraphics[ width=0.55\textwidth]{ILD/graphics/fit_2d.pdf}
		\caption{\sl The result of the two-dimensional best fit for $t\bar{t}W^\pm$ and $t\bar{t}Z^0$ cross sections (cross symbol) is shown along with its 68 and 95\% confidence level contours by the CMS experiment. The result of this fit is superimposed with the separate $t\bar{t}W^\pm$ and $t\bar{t}Z^0$ cross section measurements, and the corresponding 1 standard deviation (1\,$\sigma$) bands, obtained from the dilepton, and the trilepton/four-lepton channels, respectively. The figure also shows the predictions from theory and the corresponding uncertainties.~\cite{bib:CMSttz2014}.}
		\label{fig:LCHTopTopZ_3}
	}
\end{figure}
%ttZ cross section measurements



%2.5s tension by LEP in bbar asymmetry
\subsubsection{Future linear colliders}

The acceleration technologies available today allow for the construction and the running of a linear electron-positron collider at center-of-mass energies higher at and well above top pair production threshold. The precision of the linear colliders allows detection and reconstruction of all \sm\ decay modes of the top quark: fully leptonic, semileptonic and fully hadronic decays. 



As can be seen from expression of the differential cross section~(\ref{formula:DiffSigma_3}), the sensitivity to axial form factors is proportional to the fermion velocity $\beta$, therefore, the higher beam energies, like 500\,GeV stage at the ILC are preferred for study of electroweak top quark couplings. 
The b-quark coupling analysis can be done at all center-of-mass energies, scheduled at the ILC project.
\begin{figure}[h]
{\centering
    \includegraphics[clip, trim=0.5cm 5cm 0.5cm 7cm, width=0.95\textwidth]{ILD/graphics/epem_sm-hepph.pdf}
    \caption{\sl Tree-level cross sections of major \sm\ processes at linear colliders as function of center-of-mass energy assuming no polarization of the initial state~\cite{bib:Han}.}
    \label{fig:LCcrosssection}
  }
\end{figure}


%Matrix element method fully leptonic
%Such assets of the future $e^+e^-$ colliders as high signal-to-noise ratio and high-granularity of the detectors allow to use Matrix Element Method to compute the form factors from a kinematical fit of the top pair decay products. 
%This method can be applied at the ILC for fully leptonic decay of the top quark pair. 
%CLIC
The study of the top couplings at CLIC was done in [Garcia Garcia thesis]. 

The first top quark electroweak coupling analysis at the ILC was carried out by the ILC group in Orsay, resulting in the paper~\cite{bib:ILCTOP}, where the uncertainties on the form factors \ref{formula:SMformFactors_3} and the couplings \ref{formula:EWcouplings_3} were estimated using the ILD environment.


The semileptonic top decays were used in~\cite{bib:ILCTOP}, where  a lepton from leptonic top quark decay $t\to b l \bar{\nu_l}$ provides the charge information, and jets from hadronic top quark decays $t \to b q \bar{q}'$ are used for top polar angle reconstruction. 
The accidental assignement of the hadronic $W^\pm$ jets to the b-jet for leptonic  top quark decays leads to the migration effect in the left-handed electron beam case, caused by $W^\pm$ kinematics. 
There are two possible ways to remedy the migration effect problem - by doing a kinematical cut on $\chi^2_{top}$, which is a measure of hadronic top reconstruction quality, or by finding a correct combination of lepton charge with the b-jet charge. 
The main advantage of the combination with the b-jet charge is that this method do not require precise knowledge of the top quark decay kinematics, as it is needed for the $\chi^2_{top}$ cut method. The reconstructed top polar angle distribution for semileptonic decay of the top quark pair is shown in Fig.~\ref{fig:ILCTOPAFB}, where one sees the $W^\pm$ lepton migration effect caused by the $W^\pm$ kinematics and a it solution by the kinematical cut on $\chi^2_{top}$.


\begin{figure}[H]
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[clip, trim=0.9cm 0cm 0.9cm 0cm,width=0.99\textwidth]{ILD/graphics/EPS_AFB_nocut.pdf}
		\caption{\label{fig:ILCTOPAFB_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[clip, trim=0.9cm 0cm 0.9cm 0cm,width=0.99\textwidth]{ILD/graphics/AFB_wbkg_chi2cut.pdf}
		\caption{\label{fig:ILCTOPAFB_b_3} }
	\end{subfigure}
	\caption{\sl Reconstructed top quark polar angle before (a) and after $\chi^2_{top}$ cut (b) distributions compared with the prediction by the event generator for two configurations of the beam polarizations~\cite{bib:ILCTOP}. }
	
	\label{fig:ILCTOPAFB}
\end{figure}

The first attempt to use the jet charge technique in fully hadronic \ttbar\ decays was done by~[Amjad thesis], but it required large simulation-dependent corrections. 
Hence, one needs to investigate the reasons of inefficiency and impurity of the jet charge measurement in the ILD environment and propose a method to fix the problems. 



The development of the jet charge measurement will increase the statistics for semileptonic \ttbar\ channel,  open access to the fully hadronic \ttbar\ decay channels without any Monte-Carlo corrections and, moreover, it will allow a study of electroweak coupling of the bottom quark, which have never been done using the ILC environment. 


%Study of precision of ILC on top couplings were made by Amjad et al. using semileptonic decays. 
%Central problem: migration effect of the lepton from W. 
%B charge was first used as a way to remove migration effect by Jeremy for semileptonic channel.  and Amjad for hadronic one. 
%Development of jet charge measurement technique willl increase the statistics for semileptonic channel, and open hadronic top decays. 
%The jet charge measurement is the only way to study the bbbar process.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Jet charge reconstruction}
\label{sec:JetChargeReconstruction}
An information about the bottom jet charge is useful for all \sm\ processes, where b-jets appear as decay products, particularly, it can be applied for reconstruction of forward-backward asymmetry in $e^+e^-\to t\bar{t}$ and $e^+e^- \to b\bar{b}$ processes. 
For these processes is high purity and efficiency of the charge reconstruction requires an ultimate performance from all subdetectors of the experiment. 

One of the main goals of this thesis is to develop a method of the b-jet charge measurement with high purity and efficiency. 
To do so, first, it is necessary to measure performance of the standard reconstruction algorithm and find sources of charge impurities, and then develop an algorithm to improve it. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Setup of the study}

All studies in this and the next chapters are done using full simulation of the baseline ILD experiment. 
The jet charge measurement study uses $e^+e^- \to b\bar{b}$ at $\sqrt[]{s} = 250$\,GeV and the semileptonic decay mode of the $e^+e^- \to t\bar{t}$ at $\sqrt[]{s} = 500$\,GeV processes generated using {\sc whizard}~1.95 event generator. 
The hadronization of the quarks and gluons is done by the {\sc pythia}~6.205 event generator.
The distributions of the b-hadron momentum, generated by {\sc pythia} for the 250\,GeV $b\bar{b}$ and the 500\,GeV $t\bar{t}$ pairs are shown in Fig.~\ref{fig:GenHadronMomentum_3}. 
The distributions have different peak energies, bur the energy range is the same. Further analysis shows, that this difference has small impact on the performance of the jet charge reconstruction.
\begin{figure}[h]
	{\centering
		\includegraphics[width=0.45\textwidth]{ILD/plots/gen-hadron-momentum.pdf}
		\caption{\sl Generated b-hadron momentum by {\sc pythia} for \bbbar\ and \ttbar\ pair production processes signal processes.}
		\label{fig:GenHadronMomentum_3}
	}
\end{figure}

The $B^0-\bar{B}^0$ oscillations are enabled in the {\sc pythia} simulation. 
The ILD layout and the interaction of particles with the detector material are simulated by the {\sc mokka} framework, that provides the geometry interface to the \geant\ toolkit, that simulates the detector response. 

All reconstruction algorithms, along with the {\sc mokka} framework are part of the {\sc ilcsoft} software toolkit.
The modular structure of the {\sc ilcsoft} allows for independent execution of each reconstruction algorithm. 

%The ILD collaboration defines the order of the standard reconstruction chain, which is applied to all studies done using the full simulation of the ILD experiment. 

The most relevant standard reconstruction algorithms of the {\sc ilcsoft} for the jet charge measurement are:
\begin{itemize}
\item The MarlinTrk package organize the hits, created by particles in the ILD trackers into reconstructed tracks. The track parametrization in described in~\cite{bib:LCIOtrack}. Each reconstructed track has 5 reconstructed fit parameters and the corresponding associated covariance matrix with 15 parameters; The most important for the thesis are the impact parameters $d_0$ and $z_0$ with corresponding uncertainties $\sigma_{d_0}$ and $\sigma_{z_0}$.
\item The PandoraPFA package is responsible for the clusterization of the calorimeter hits and creation of the Particle Flow Objects. The track covariance matrix is used to compute the covariance matrix of the reconstructed particle momentum; 
\item The primary and secondary vertex reconstruction is done by the LCFI+ algorithm. 
\end{itemize}
The jet clustering algorithms can be configured and launched according to the analysis requirements. 
The flavor-tagging at the ILD experiment will serve to separate out jets from bottom and charm quarks from the light quark or gluon jets.
The flavor-tagging algorithm within the LCFI+ package provides  b- and c-tagging information.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Bottom quark topology}

The charge of the b-quark can be derived from the properties of the b-hadron and its decay products. 
%Therefore, one needs to know precisely the properties of the underlying hadrons. 


The b-quark hadronization modes are displayed in Table~\ref{table:bhadrons}.
\input{ILD/tables/b-hadrons}

These branching fractions are approximate and may have a dependency on the initial and final state kinematic and production environment~\cite{bib:PDG}.
However, the presence of the \Bzs\ meson increase number of the neutral hadronization modes, which will cause additional complications for the charge measurement. 
The illustration of the b-quark hadronization and common decay modes is given in Fig.~\ref{fig:Bmodes_3}.
\begin{figure}[h]
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/b-modes}
		\caption{\sl The illustration of the b-quark hadronisation and decay modes with the corresponiding decay rates in percent. Modes in the red circle are not tracked by the TruthVertexFinder.}
		\label{fig:Bmodes_3}
	}
\end{figure}

%b-hadron decays, typically, the charged pions, kaons, leptons or protons, 
Due to the Lorentz boost given by the initial b-quark energy, the b-hadron can travel several millimeters before its decay. Due to this flight distance, the charged particles from the b-hadron decays will have an offset with respect to the primary interaction point, which is the main signature of the b-quark jets. 

%Therefore we expect two vertices
The B meson have $D^0$ or $D^\pm$ meson decay modes of about 80\% decay rate, mediated by the weak interaction. The charmed $D$ mesons have $c\tau \approx 120 - 300$\,$\mu$m, which gives a possibility to the charmed mesons to travel away from the initial B meson decay vertex. 
Hence, one expects to detect two vertices from one b-jet in most of the cases: the secondary, which corresponds to the b-hadron decay, and the tertiary vertex created by the c-hadron decays. 

The $K^\pm$ mesons from B meson decays are the end products of the $b\to c\to s$ decay chain mediated by the weak interaction. 
The $K^\pm$ mesons have a long lifetime with $c\tau = 3.7$\,m and a high mass of 493.6\,MeV comparing with another long-lived charged particles from B meson decays, like pions or leptons, which can be use to identify kaons by the energy deposition. 
In the generator, about 87\% of b-hadrons are set to have correlated $K^\pm$ charge in the generator, which makes the $K^\pm$ charge a reliable indication of the initial b-quark charge.
On contrary, the b-baryons tend to produce protons, which have an opposite sign of charge to the initial b-quark charge. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Generated vertices}
The output of the event generators is a list of generated particles with parent-child relations.The TruthVertexFinder algorithm was developed to find the generated vertices.%, and included into the {\sc ilcsoft} distribution. 
This algorithm detects the generated b-hadrons, finds the related charged particles, which can leave reconstructable tracks and organizes them into the generated secondary or tertiary vertices.
\begin{figure}
	{\centering
		\includegraphics[width=0.75\textwidth]{ILD/plots/offset-graph.pdf}
		\caption{\sl Illustration of particle offset variable $\epsilon$, where $\vec{p}$ is a vector of a given particle momentum, $B$ is a flight distance of a b-hadron, $\vec{IP}$ is a primary vertex position, $\vec{t}_0$ is a point of the closest approach of a given particle. 
		}
		\label{fig:OffsetPic_3}
	}
\end{figure}



%Generator distributions


%The b-hadrons can be identified by measuring the charged tracks, which have an offset from primary interaction point caused by the b-hadron lifetime.
%B*
The high-energy b-quarks can hadronize into excited states of the b-hadrons, which can decay into their ground state by emitting charged or neutral pion. 
The charged pion from the excited b-hadrons can distort the charge multiplicity distributions and further comparison with the reconstructed vertices. Therefore, the TruthVertexFinder selects only ground state hadrons within a decay chain. 

The TruthVertexFinder finds vertices from b-hadron decays and subsequent c-hadron decay vertices. The distributions of generated b- and c-vertices are displayed in Fig.~\ref{fig:GenVtx_3}. The c-vertex multiplicity distribution is consistent with~\cite{bib:PDG}. One can notice that about 31\% of the b-vertices and 13\% of the c-vertices decay into one generated prong, which poses a challenge to the vertexing algorithms., which will be addressed in Sec.~\ref{sec:MisVertices}.

\begin{figure}
\centering
\begin{subfigure}{0.5\textwidth}
    \includegraphics[width=0.95\textwidth]{ILD/plots/gen-b-vtx.pdf}
\caption{\label{fig:GenVtx_a_3} }
\end{subfigure}% 
  \begin{subfigure}{0.5\textwidth}
\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/gen-c-vtx.pdf}
\caption{\label{fig:GenVtx_b_3} }
\end{subfigure}
    \caption{\sl Distributions of the b-vertex charge multiplicity~(a) and c-vertex charge multiplicity~(b). }
    \label{fig:GenVtx_3}
\end{figure}

The particle offset or the impact parameter is the minimal distance between the particle trajectory and the interaction point, as illustrated in Fig.~\ref{fig:OffsetPic_3}.
This is the main observable used by the vertex reconstruction algorithms. 
The offset distributions of the generated b-vertex and c-vertex prongs are shown in Fig.~\ref{fig:GenVtxOffset_3}.
Majority of the generated prongs have large offsets above the ILD impact parameter resolution of 5\,$\mu$m. 
As can be seen from Fig.~\ref{fig:GenVtxOffset_3}, the c-vertex prong offsets are larger than b-vertex prong offsets, because of the additional distance traveled by c-hadron from the b-hadron decay point. 

\begin{figure}
\centering
\begin{subfigure}{0.5\textwidth}
    \includegraphics[width=0.95\textwidth]{ILD/plots/gen-bvtx-offsets.pdf}
\caption{\label{fig:GenVtxOffset_a_3} }
\end{subfigure}% 
  \begin{subfigure}{0.5\textwidth}
\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/gen-cvtx-offsets.pdf}
\caption{\label{fig:GenVtxOffset_b_3} }
\end{subfigure}
    \caption{\sl Distributions of the b-vertex (a) and c-vertex prong offsets~(b). }
    \label{fig:GenVtxOffset_3}
\end{figure}

The distributions of the total charge multiplicity and the flight distance of the b-hadrons are displayed in Fig.~\ref{fig:GenHadronParams_3}.
The imbalance between the odd and even number of multiplicities is caused by the presence of the \Bzs\ hadronization modes.

Regarding the similarity of the distributions for two processes shown in Figures~\ref{fig:GenVtx_3}, \ref{fig:GenHadronParams_3} and \ref{fig:GenVtxOffset_3}, the performance of a vertexing algorithm should be identical for the same energy and the direction of the b-hadron decays.


\begin{figure}
\centering
\begin{subfigure}{0.5\textwidth}
    \includegraphics[width=0.95\textwidth]{ILD/plots/gen-hadron-multiplicity.pdf}
\caption{\label{fig:GenHadronParams_a_3} }
\end{subfigure}% 
  \begin{subfigure}{0.5\textwidth}
\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/jet-multi.pdf}
\caption{\label{fig:GenHadronParams_b_3} }
\end{subfigure}
    \caption{\sl Left: Distribution of the b-hadron charge multiplicity. The odd multiplicities correspond to the charged hadrons and the even multiplicities correspond to the neutral hadron decays. Right: Distribution of the reconsructed b-jet multiplicities for two processes. }
    \label{fig:GenHadronParams_3}
\end{figure}


%The design of the ILD vertex detector is optimized to have the best offset resolution 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Standard vertex reconstruction in the ILD}
The LCFI+ package finds the secondary and tertiary vertices and tags the b- and c-jets using the charged particles among the Particle Flow objects.
It has several stages of the vertex reconstruction and flavor-tagging, which are implemented in the following algorithms:
\begin{itemize}
\item PrimaryVertexFinder finds the position of the primary interaction point and the corresponding charged particles;
\item BuildUpVertex forms the reconstructed vertex candidates, which can have two or more associated charged particles, referred in the text as reconstructed prongs;
\item JetVertexRefiner finds vertices with only one prong using the reconstructed vertex candidates and it organizes the vertex candidates into maximum two reconstructed vertices per jet.
\item FlavorTag algorithm calculates b-tag and c-tag values for a jet, using the finalized jet vertices from the JetVertexRefiner. The b-tag and c-tag values are the measure of b- and c-likeness of a jet, respectively, both observables have values from 0 to 1. Performance of the flavor-tagging algorithm is shown in Fig.~\ref{fig:LCFIplus_3}.
\end{itemize}

\begin{figure}
	{\centering
		\includegraphics[width=0.45\textwidth]{ILD/graphics/btag-cbg.eps}
		\caption{\sl The tagging efficiency is shown for b-jets with the mis-identification	fraction evaluated using c-jets. Solid lines correspond to the case of 2-jet events at $\sqrt{s} = 91$\,GeV. Dashed lines correspond to the case of 6-jet events at	$\sqrt{s} = 500$\,GeV. Dotted lines correspond to the case of 6-jet events at $\sqrt{s} = 1000$\,GeV~\cite{bib:LCFI}.
		}
		\label{fig:LCFIplus_3}
	}
\end{figure}
In this section, only the standard reconstruction chain is used to study the b-jet charge measurement. 


%\subsubsection{Baseline jet charge reconstruction}
The jet charge is computed as a sum of the reconstructed particles charges, associated to the reconstructed vertices, which belong to a given jet. 
Therefore, the vertexing algorithm should correctly associate all secondary or tertiary vertex particles to have a correct jet charge measurement. 
The correctly reconstructed jet charge should have the same  charge as the generated b-hadron. 
Regarding the b-hadron multiplicity, shown in Fig.~\ref{fig:GenHadronParams_a_3}, and the b-jet multiplicity in Fig.~\ref{fig:GenHadronParams_b_3} this task is not trivial. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Jet charge purity: State of the art}
The charge purity $P_B$ is defined as the number of correctly reconstructed jet charges $N_{correct}$ divided by the total number of jets $N_{total}$:
\begin{equation}
	\label{formula:Purity_3}
	P_B = \frac{N_{correct}}{N_{total}}.
\end{equation} 
The previous studies caried out for the fully hadronic $t\bar{t}$ decays~[Amjad] have shown that the total jet charge purity $P_B$ is about 60\%.
The total jet charge for the considered $b\bar{b}$ process  is $P_B(b\bar{b}) = 66\%$ and for semileptonic decay of the  $t\bar{t}$ pair is $P_B(t\bar{t}) = 64\%$. 
The small difference between these values is caused mostly by the difference in the generated momentum  distributions displayed in Fig.~\ref{fig:GenHadronMomentum_3} and by the difference in the jets environments.

Using the output of the TruthVertexFinder, one compares the generated vertices with the corresponding reconstructed vertices, detected by the LCFI+ algorithms. 
Figure~\ref{fig:Table_3} shows the comparison of the number of the generated prongs $N_{gen}$ with the number of the reconstructed prongs $N_{rec}$ on the jet-per-jet basis. 
The row with $N_{rec} = 0$ are the jets, which have no associated reconstructed vertices, will cause the efficiency decrease in the jet charge measurement, however, they have no influence on the method purity.
The jets with reconstructed vertices have the following statistics:
\begin{itemize}
\item Only 49\% of these jets are perfectly reconstructed and have $N_{rec}=N_{gen}$;
\item The 46\% of the jets have lost one or more prongs from the reconstructed vertices having $N_{rec}<N_{gen}$;
\item The rest 5\% are the jets with vertices, contaminated by particles with non b-hadron origin and have $N_{rec}>N_{gen}$.
\end{itemize}

\begin{figure}
{\centering
    \includegraphics[width=0.55\textwidth]{ILD/plots/rec-gen-table.pdf}
    \caption{\sl Comparison of the number of reconstructed tracks $N_{gen}$ to the number of generated tracks $N_{rec}$ for a given b-jet. The number of entries is color-coded for each cell. The diagonal has 49\% of all entries and it contains the jets, which have the correctly reconstructed vertices. The b-jets below diagonal have vertices with one or more particles missed by reconstruction. The row $N_{rec} = 0$ corresponds to the b-jets with no reconstructed vertices. %Right: Same comparison, but after a cut on the b-tag$> 0.8$ and a cut on the b-hadron momentum more than 20\,GeV. The diagonal contains 55\% of the jets after the cuts.
    }
    \label{fig:Table_3}
  }
\end{figure}

The jets with $N_{rec}=N_{gen}$ have the charge purity of more than 97\%, while all other jets have an almost random reconstructed jet charge with the corresponding charge purity about 35\%.
The fraction of entries above diagonal in Fig.~\ref{fig:Table_3} is small, comparing to the fraction of events above the diagonal. 
Hence, the purity reduction is mainly caused by the jets, which have lost the prongs from their reconstructed vertices. 
%The application of cuts, for example on jet b-tag$>0.8$ and reconstructed b-hadron momentum $|p_{had}| > 20$\,GeV, increases the fraction of correctly reconstructed jets up to 55\%, however with an efficiency penalty of 17\%.
%The cuts on the b-tag value are necessary to reject background processes and will be adjusted to archieve the best background suppression. 


Therefore, there is a possibility to develop a recovery algorithm, which can add the missing prongs to the reconstructed vertices, with a slight increase of the number of jets with contaminated vertices. 
But first, one needs to study the reasons behind the missing prongs and analyze the possibility to recover them. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Missing vertices}
\label{sec:MisVertices}
%The vertex reconstruction algorithm may fail if the generated b-hadron properties, like number of generated prongs, b-hadron momentum or polar angle, are in the poor acceptance of the detector. 
%The non-reconstructed vertices contain approximately 22\% of all generated b-hadron prongs. 
%The b-hadron vertices with generated low momentum prongs or low offset prongs have higher chances to be missed by the reconstruction algorithms. 
%The distributions of the average prong offset and momentum for reconstructed vertices and missed vertices are shown in Fig.~\ref{fig:RecMissedParams_3}. 
%On can conclude, that the reconstruction algorithms start to lose their efficiency at below 4\,GeV average prong momentum and below 0.5\,mm average prong offset. 


The polar angle distributions of the missing vertices is displayed in Fig.~\ref{fig:MissedCos_3}. 
One can summarize the reasons for missing vertices as following: 
\begin{itemize}
\item Neutral decay vertex - the vertex cannot be reconstructed if it has no generated prongs;
\item Low energy of the generated b-hadron causes a short flight distance, small offsets or low momentum of the generated prongs, which makes it difficult to separate out the b-hadron prongs from the other particles in a b-jet;
\item A one prong decay vertex can be lost if there was no other vertices reconstructed in a given b-jet;
\item Most of the b-hadrons, produced in the forward region, or outside the barrel VXD acceptance $|\cos\theta_{vtx}| > 0.95$, are not reconstructed, which is due to a low precision on the impact parameters of the reconstructed prongs. 
\end{itemize}

\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/rec-missed-p-vtx.pdf}
		\caption{\label{fig:RecMissedParams_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/rec-missed-s-vtx.pdf}
		\caption{\label{fig:RecMissedParams_b_3} }
	\end{subfigure}
	\caption{\sl Distributions of the average prong momentum~(a) and offset (b) of the missed and reconstructed vertices. }
	\label{fig:RecMissedParams_3}
\end{figure}

\begin{figure}[h]
	{\centering
		\includegraphics[clip, trim=10.cm 0cm 0.cm 0cm, width=0.55\textwidth]{ILD/plots/missed-cos-vtx.pdf}
		\caption{\sl Polar angle distribution of the missed vertices subdivided into different categories. This is a stacked histogram. The low momentum or low offset category are the missing vertices, which have the average prong momentum below  4\,GeV or below 0.5\,mm average prong offset.
		}
		\label{fig:MissedCos_3}
	}
\end{figure}
%An attempt was made to reduce the vertexing inefficiency in the forward region

The missing vertices are difficult to recover, however they have essentially no impact on the jet charge purity, therefore the further studies are focused on the missing prongs of the reconstructed vertices.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Missing prongs from the reconstructed vertices}
\label{sec:MissingProngs}
The quality of the vertex reconstruction strongly depends on all reconstruction algorithms as well as on various geometry aspects of the ILD experiment. 

%Using TruthVertexFinder information and truth links to the reconstructed particles, one can find, that the 
The missing reconstructed prongs are approximately 10.4\% of the total generated prongs for the standard vertex reconstruction. 
The reasons for the missing prongs can be summarized as follows:
\begin{itemize}
\item No tracking information - the MarlinTrk algorithms fails to reconstruct the track. This category is tiny - only 0.93\% of the generated prongs;
\item No associated hits in the VXD or FTD - the track segment from the Vertex Detector or Forward Tracking Disks was not connected to the long TPC track segment. These reconstructed particles have large uncertainties on the impact parameters, which makes them not suitable for vertexing algorithms. They constitute 2.\% of the generated prongs;
\item No reconstructed PFO - the PandoraPFA fails to create the PFO from a reconstructed track. These tracks are discarded by the LCFI+ algorithms - 3.2\%  of the generated prongs;
\item Low generated momentum or offset  - the reconstructed particle was produced with impact parameters below the detector resolution - 3.1\%  of the generated prongs;
\item Other reasons, mostly because of the vertex fitting problems - 1.7\% of the generated prongs.
\end{itemize}



\begin{figure}
\centering
\begin{subfigure}{0.5\textwidth}
    \includegraphics[width=0.95\textwidth]{ILD/plots/missed-tracks.pdf}
\caption{\label{fig:MissingTracks_cos_3} }
\end{subfigure}% 
  \begin{subfigure}{0.5\textwidth}
\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/missed-momentum.pdf}
\caption{\label{fig:MissingTracks_p_3} }
\end{subfigure}
    \caption{\sl Polar angle~(a) and momentum~(b) distributions of the missing prongs subdivided into different categories. This is a stacked histogram. The peak at $|\cos\theta| \approx 0 $ is caused by the gap between TPC endplates, the peak at  $|\cos\theta| \approx 0.8$ is caused by barrel-endcap transition in the \ecal\ and the rapid increase at $|\cos\theta| \approx 0.9$ is caused by the barrel-endcap transition in the VXD and FTD system. }
    \label{fig:MissingTracks_3}
\end{figure}

These categories of the missing prongs can be illustrated by the polar angle histogram, shown in Fig.~\ref{fig:MissingTracks_cos_3}, which also reveals the following problems connected to the ILD geometry:
\begin{itemize}
\item Small peak at $|\cos\theta| \approx 0$ is caused by the TPC anode gap. 
\item Large peak at $|\cos\theta| \approx 0.8$ is caused by the PandoraPFO, which fails to connect a well reconstructed track with an offset to a segmented cluster located in the calorimeter barrel-endcap transition. This problem is specific to the b-hadron tracks;
\item Increase at $|\cos\theta| \approx 0.9$ correspond to the end of the full 3 double layer VXD acceptance, resulting in an increase in the impact parameter uncertainties of the reconstructed tracks. %caused by a connection problem between the VXD track segments, which are in the acceptance region of the two double-sided VXD layers, and the FTD track segments.
\end{itemize}

The recoverable prongs are those, which were lost because of the reconstruction problems, like the problems with the PFO creation, and not by the limited detector acceptance.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Vertex charge recovery}
\label{sec:VtxRecovery}
The objective of the vertex recovery algorithm is to add accurately the missing prongs to the reconstructed vertices, without contamination by the particles with non b-hadron origin or the background particles. 

%The most important observable for any vertexing algorithm is the particle offset $\epsilon$.
%The uncertainty on the offset $\sigma$ for a given reconstructed charged particle can be computed as 
%\begin{equation}
%	\sigma = \sqrt[]{\sigma_{d_{0}}^2 + \sigma_{z_0}^2},
%%\end{equation}
% 


In this studies we use the following definition of the offset significance:

\begin{equation}
	\epsilon/\sigma = |\frac{d_0}{\sigma_{d_0}}| + |\frac{z_0 }{ \sigma_{z_0}}|,
\end{equation}
where $\sigma_{d_{0}}$ and $\sigma_{z_0}$ are the covariance matrix elements, provided by the track reconstruction algorithms.
Value of offset significance strongly depends on the momentum of the particle, its polar angle and number of VXD or FTD hits. 

Typically, the b-hadrons prongs are generated with large offsets (Fig.~\ref{fig:GenHadronParams_b_3}), but the reconstruction can miss a reconstructed prong if it has a small offset deviation. 
Hence, one needs another spatial separation variable, combined with the offset deviation $\epsilon/\sigma$. 

Another separation variable can make use of the reconstructed vertex position and the reconstructed track candidate parameters. 

The particle trajectory bending because of magnetic field is negligible at the small distance scales, like the b-hadron flight distance in Fig.~\ref{fig:GenHadronParams_b_3}. 
Therefore, in this studies, the reconstructed track helix is approximated by the reconstructed vector of particle momentum. 

This study uses an angle $\alpha$, as a second separation variable, defined as an angle between the vector of particle momentum $\vec{p}$ and the vector of difference between vertex position $\vec{s}$ and track reference point $\vec{t}$, defined in \cite{bib:LCIOtrack}. The separation variables, the angle $\alpha$ and the offset $\epsilon$, are illustrated in Fig.~\ref{fig:VtxRecovery_3}.

\begin{figure}
{\centering
    \includegraphics[width=0.75\textwidth]{ILD/plots/recovery-graph.pdf}
    \caption{\sl Illustration of the chosen separation variables of the vertex charge recovery algorithm, where $\vec{p}$ is a vector of a given particle momentum, $B$ is a flight distance of a b-hadron, $\vec{IP}$ is a primary vertex position, $\vec{t}$ is a reference point of a given particle, defined in \cite{bib:LCIOtrack}, $\alpha$ is the angle between $\vec{p}$ and $\vec{s}$ and $\epsilon$ is an offset distance of the particle. %Right: Same comparison, but after a cut on the b-tag$> 0.8$ and a cut on the b-hadron momentum more than 20\,GeV. The diagonal contains 55\% of the jets after the cuts.
    }
    \label{fig:VtxRecovery_3}
  }
\end{figure}

An algorithm, called VertexChargeRecovery, was developed to increase the jet charge purity by adding the missing prongs to the reconstructed vertices.  For a given jet, which has at least one associated reconstructed vertex, the VertexChargeRecovery has the following procedure:

\begin{itemize}
\item Preparation of the prong candidates - the algorithm uses all charged particles within a given jet as prong candidates. To recover the prongs, which has no reconstructed PFO, the program iterates throughout all reconstructed tracks and reconstructs them as charged PFOs without an associated calorimeter cluster. These new Particle Flow particles are used only if they have no duplicates in the previously selected jet particles;
\item All prong candidates are compared to the reconstructed prongs to avoid duplicates;
\item The separation variables $\alpha$ and $\epsilon$ are calculated for each prong candidate and a given reconstructed vertex;
\item The selection condition can be defined using the $\alpha$ and $\epsilon$ distributions for true b-hadron prongs and background particles, which are displayed in Fig.~\ref{fig:RecoveryPurity_3}, suggest the following cuts:
\begin{equation}
\epsilon/\sigma > 2 + 25\cdot\alpha\text{ and } \alpha < 0.08.
\end{equation}
The recovery algorithm might have different behavior in simulation, than in real experiment, therefore, one should use a data-driven charge purity measurements, described in Sec.~\ref{sec:ChargePurity}, to test and tune the recovery parameters.
\item The algorithm creates new reconstructed vertices with old and recovered reconstructed prongs and links them to a given jet.
\end{itemize}

\begin{figure}
	\centering
	\begin{subfigure}{0.33\textwidth}
		\includegraphics[clip, trim=0.1cm 0cm 13.9cm 0cm,width=0.99\textwidth]{ILD/plots/recovery-purity.pdf}
		\caption{\label{fig:RecoveryPurity_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=6.78cm 0cm 7.3cm 0cm,width=0.99\textwidth]{ILD/plots/recovery-purity.pdf}
		\caption{\label{fig:RecoveryPurity_b_3} }
	\end{subfigure}
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=13.6cm 0cm 0.4cm 0.cm,width=0.99\textwidth]{ILD/plots/recovery-purity.pdf}
		\caption{\label{fig:RecoveryPurity_c_3} }
	\end{subfigure}
	\caption{\sl Distribution of the separation variables, the angle $\alpha$ and the offset significance $\epsilon/\sigma$ for the missing generated prongs and the background charged particles. Purity map shows the highest concentration of the missing generated prongs as compare to all charged particles. The black line demonstrates a possible cut function. }
	
	\label{fig:RecoveryPurity_3}
\end{figure}

Hence, VertexChargeRecovery is made to have an output, identical to the output of the LCFI+ algorithms, which allows for a clear comparison of the jet charge reconstruction performance before and after vertex recovery usage.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Results of the vertex recovery}

The simple algorithm of the vertex recovery is limited by the requirement of the presence of a reconstructed vertex and the reconstruction quality of a missing b-hadron prong. 
Nevertheless, this algorithm makes a significant improvement in the vertex reconstruction and the jet charge purity.

\begin{figure}
{\centering
    \includegraphics[width=0.55\textwidth]{ILD/plots/recovery-table.pdf}
    \caption{\sl Comparison of the number of reconstructed tracks $N_{gen}$ to the number of generated tracks $N_{rec}$ for a given b-jet after vertex charge recovery. The number of entries is color-coded for each cell. The fraction of the diagonal elements, which have the perfectly reconstructed vertices, is 62\% of all entries. The b-jets below diagonal have vertices with one or more particles missed by reconstruction. The row $N_{rec} = 0$ corresponds to the b-jets with no reconstructed vertices. %Right: Same comparison, but after a cut on the b-tag$> 0.8$ and a cut on the b-hadron momentum more than 20\,GeV. The diagonal contains 55\% of the jets after the cuts.
    }
    \label{fig:RecoveryTable_3}
  }
\end{figure}


The VertexChargeRecovery increases the fraction of correctly reconstructed jets from 49\% to 62\%, as it is illustrated in Fig.~\ref{fig:RecoveryTable_3}. 
This improvement is done by reducing the fraction of jets with $N_{rec} < N_{gen}$, below diagonal in Fig.~\ref{fig:RecoveryTable_3}. 
The slightly increased rate of jets with $N_{rec} > N_{gen}$ can be seen, which is an unavoidable shortcoming of the algorithm. 



\begin{figure}
\centering
\begin{subfigure}{0.5\textwidth}
    \includegraphics[width=0.95\textwidth]{ILD/plots/recovery-missed-cos.pdf}
\caption{\label{fig:RecoveryMissingTracks_cos_3} }
\end{subfigure}% 
  \begin{subfigure}{0.5\textwidth}
\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/recovery-missed-p.pdf}
\caption{\label{fig:RecoveryMissingTracks_p_3} }
\end{subfigure}
    \caption{\sl Polar angle~(a) and momentum~(b) distributions of the missing prongs after vertex charge recovery subdivided into different categories. These are stacked histograms. }
    \label{fig:RecoveryMissingTracks_3}
\end{figure}

The vertex recovery decreases the fraction of missing prongs from 10.4\% to 6.2\%. The new polar angle and momentum distributions are shown in Fig.~\ref{fig:RecoveryMissingTracks_3}, from which one sees the following changes:
\begin{itemize}
\item The algorithm does not changes the categories of b-hadron prongs, which have no reconstructed tracks;
\item The reconstructed prongs with no assigned VXD or FTD hits are not recovered by the program;
\item The most of the missing prongs, which have no corresponding PFO are successfully associated to the correct reconstructed vertices;
\item The large peak of the missing prongs at $|\cos\theta| \approx 0.8$ is successfully eliminated;
\item The prongs in the region of the strong background, as can be seen in Fig.~\ref{fig:RecoveryPurity_3}, are not used by the program;
\item The missing prongs, which where lost by other means, are successfully recovered by the algorithm.
\item The vertex recovery can use all particles, even the ones with a small momentum, below 1\,GeV or outside the barrel VXD acceptance. 
\end{itemize}

%To resolve the inefficiencies, caused by the tracking, one can apply different VXD tracking algorithms, like minivector tracking. 

The central result of the algorithm is that it enhances the jet charge purity from 66\% to 73\%, despite increase of the contamination by the  background particles from 3\% to 4\%.
Figure~\ref{fig:RecoveryPurityComparison_3} demonstrates the improvement of the jet charge purity as function of the jet b-tag, reconstructed b-hadron momentum, $N_{rec}$ and the polar angle of the b-hadron  $|\cos\theta_{vtx}|$.
\begin{figure}
{\centering
    \includegraphics[width=0.95\textwidth]{ILD/plots/recovery-purity-comparison.pdf}
    \caption{\sl Comparison of the purity as function of the jet b-tag, reconstructed b-hadron momentum, $N_{rec}$ and the polar angle $|\cos\theta|$ before and after the vertex recovery algorithm.  
    }
    \label{fig:RecoveryPurityComparison_3}
  }
\end{figure}
One can see the following changes induced by the recovery algorithm:
\begin{itemize}
\item Jets with a high b-tag have higher chances to be recovered. The b-tag value strongly depends on the offsets of the reconstructed prongs, the low b-tag jets have less significant offsets of particles, which makes them  harder to recover. 
\item The algorithm improves the jets with a moderate reconstructed b-hadron momentum. %The algorithm should be tuned to work with highly collimated vertices produced by high momentum b-hadrons.
\item The large improvement can be seen for the jets or reconstructed b-hadrons with low number of reconstructed prongs, especially for $N_{rec}=3$.% For higher multiplicity, the algorithm should recover all tracks correctly, which is not trivial. Hence, almost no improvement is seen for the reconstructed b-hadrons with large $N_{rec}$.
\item The algorithm is capable to increase the purity in the barrel VXD acceptance and recover the non-reconstructed PFO particles at $|\cos\theta_{vtx}| \approx 0.8$. 
\end{itemize}
The jet charge purity can be also increased by applying cuts on the reconstructed observables up to 80\% purity with 60\% efficiency or by application of MVA algorithm.

To summarize, the VertexChargeRecovery is able to significantly improve the jet charge purity and equalize it in the polar angle spectrum, which is crucial for reconstruction of heavy quark differential cross section. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Using the $dE/dx$ information}

A complementary method to measure the b-jet charge is to identify among the reconstructed b-hadron prongs the charged kaon $K^\pm$, which carry the information about the initial b-quark charge. 

The charged kaons have much higher mass than the charged pions and lower mass than protons, which give a possibility to identify charged kaons by the energy deposition of the hits in the subdetectors. 

The most suitable device to calculate the energy deposition per distance passed, the $dE/dx$ value, is the ILD TPC due to its bulk gaseous environment. 


The $dE/dx$ as a function of particle momentum and $|\cos\theta|$ for different hadrons is shown in Fig.~\ref{fig:dEdxBefore_3}. One can immediately spot the dependence of the $dE/dx$ value on the polar angle of the particles. This happens because of the knocked-out electron emittance or $\delta$-ray probability is increased with increasing length of the TPC track. Therefore, one needs to apply an angular correction to remove the angular dependence of the $dE/dx$ value, which is 
\begin{equation}
	\frac{dE}{dx}\to\frac{dE}{dx}\theta^{0.15},
    \label{formula:dEdxCorrection}
\end{equation}
where $\theta$ is the polar angle of the particle. 
This angular is known to be applied at other experiments, which have the TPC devices~\cite{bib:HARP}.

The distributions of the $dE/dx$ as a function of particle momentum and $|\cos\theta|$ after the angular correction (\ref{formula:dEdxCorrection}) are displayed in Fig.~\ref{fig:dEdxAfter_3}.
%116.90%
\begin{figure}
{\centering
    \includegraphics[clip, trim=8cm 18.5cm 7cm 4cm,width=0.95\textwidth]{ILD/plots/dedx-before.png}
    \caption{\sl The energy deposition per track length $dE/dx$ as function of the particle momentum, the particle polar angle $|\cos\theta|$ for different particles. Two gray lines separate out the region with a maximal kaon concentration. 
    }
    \label{fig:dEdxBefore_3}
  }
\end{figure}

\begin{figure}
{\centering
    \includegraphics[clip, trim=8cm 18.5cm 7cm 4cm, width=0.95\textwidth]{ILD/plots/dedx-after.png}
    \caption{\sl The energy deposition per track length $dE/dx$ as function of the particle momentum, the particle polar angle $|\cos\theta|$ for different particles after application of the angular correction, described in text. Two gray lines separate out the region with a maximal kaon concentration. 
    }
    \label{fig:dEdxAfter_3}
  }
\end{figure}

A simple cut-based algorithm was developed to identify the particle type (PID) using $dE/dx$ information after angular correction, which can identify kaons with 97.\% purity and 87.7\% efficiency.
The results of the hadron identification algorithm are displayed in Fig.~\ref{fig:dEdxResults_3}.

The angular correction is now included in the latest version of the {\sc ilcsoft} distribution.

\begin{figure}
{\centering
    \includegraphics[width=0.45\textwidth]{ILD/plots/dedx-results.pdf}
    \caption{\sl Correlation histogram between generated particle type and reconstructed particle type produced by the cut-based PID algorithm.
    }
    \label{fig:dEdxResults_3}
  }
 
\end{figure}


Given the reconstruction purity illustrated in Fig.~\ref{fig:dEdxResults_3} and the correlation between kaon charge and the b-hadron charge in Fig.~\ref{fig:KaonOscillation_3}, one concludes that the reconstructed charged kaons from the reconstructed vertices provide a reliable information on the charge of the initial b-hadron or b-quark. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section{Top quark production at the ILC}
%Direct electroweak production of the top quark pairs
This section of the thesis describes an application of the jet charge measurement technique, described in Sec.~\ref{sec:JetChargeReconstruction}, to the polar angle measurement for $e^+e^- \to t\bar{t}$ process at ILC, which is used to determine the electroweak couplings of the top quark.

%The measurements of the top quark properties is one of the key points of the \sm\ physics program at the ILC.

\subsection{Properties of the top quark}

The top quark is the heaviest elementary particle in the \sm\ with measured mass of 173.34$\pm$0.27(stat)$\pm$0.71(syst) \,GeV~\cite{bib:TopMass}. This implies a very short lifetime of approximately 5$\cdot10^{-25}$\,s.
The top quark lifetime is short compared to a time needed for hadronization process  (10$^{-23}$\,s). Therefore, the top quark decays too fast to form hadrons. 
This fact permits to study the bare quark properties, like spin, via its decay particles. 

The dominant decay mode of the top quark is $t\to bW^+$, which is 99.8\% of all top decays in the \sm. The $W^\pm$ boson decays either into a lepton-neutrino pair or into a pair of quarks. The top quark decays thus leads to a six fermion final state of the $e^+e^-\to t\bar{t}$ process.
The $t\bar{t}$  decays are classified by the $W^\pm$ decay modes:
\begin{itemize}
	\item Fully hadronic decay $t\bar{t} \to bq\bar{q} \bar{b} q\bar{q}$ -  46.2\% of branching ratio;
e	\item Semileptonic decay $t\bar{t} \to bq\bar{q} \bar{b} l\nu_l$ - 43.5\% of branching ratio;
	\item Fully leptonic decay $t\bar{t} \to b l^- \nu_{l^-} \bar{b} l^+\nu_{l^+}$ - 10.3\% of branching ratio.	
\end{itemize}


At the ILC it is possible to reconstruct and study all decay modes of the $t\bar{t}$ pair with a high selection efficiency.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Setup of the study}
%The top quark pairs at the ILC can be produced at $\sqrt{s}=350$\,GeV and 500\,GeV. 
In this section of the thesis, the semileptonic $t\bar{t}$ pairs produced at $\sqrt{s}=500$\,GeV in the left-handed beam configuration are studied using full ILD simulation.
The top quark polar angle in the right-handed beam configuration was successfully reconstructed in \cite{bib:Doublet}\cite{bib:ILCTOP}.
The chosen center-of-mass energy allows for top pair production free from $t\bar{t}$ threshold QCD effects.
The cross sections at the Born level of the signal process $e^+e^- \to t\bar{t}$ and the major \small\ background processes at the $\sqrt{s} = 500$\,GeV are summarized in Table~\ref{table:ttbarsigma}.

The clear process signature of two b-jets, two light jets from $W^\pm$ boson and an isolated lepton makes the semileptonic decay mode easily reconstructable and usable for the forward-backward asymmetry $A_{FB}$ measurement. 
An example of a \ttbar\ event in the ILD environment is shown in Fig.~\ref{fig:TopEvent_3}.

\begin{figure}
	{\centering
		\includegraphics[clip, trim=0.cm 0cm 7.9cm 0cm, width=0.55\textwidth]{ILD/graphics/ild-ttbar.png}
		\caption{\sl Event display of the \ttbar\ pair production process in the ILD simulation.
		}
		\label{fig:TopEvent_3}
	}
	
\end{figure}
%This choice is motivated to use the b-jet charge measurement to overcome the $W^\pm$ lepton migration effect, described in~\cite{bib:ILCTOP}, it also allows for a direct comparison and combination of the new results with previous studies done using $W^\pm$ lepton charge method.

%This chapter concentrates only on the left-handed electron polarization case, because of the lepton migration problem caused by the $W^\pm$ kinematics. 
%The previous studies found  
The main goal of the study is to develop an alternative method to paper~\cite{bib:ILCTOP} by involving new b-jet charge measurement techniques, which should bring down the statistical uncertainties on the \ttbar Z$^0$ form factors and couplings.  

%\subsection{Top quark decay modes}

\subsection{Top quark reconstruction}
In this thesis, the top reconstruction method, which was developed for~\cite{bib:ILCTOP} is applied. It has the following steps:
\begin{itemize}
	\item Isolated lepton identification is done with the LAL LeptonFinder algorithm~\cite{bib:Doublet}, which is designed to find an energetic lepton or a lepton, which has a significant transverse momentum with respect to the neighbored jets. 
	\item The events, after excluding the isolated lepton, are clustered into four jets by the Durham jet clustering algorithm.
	\item The b-jet tagging done by LCFI+ is used to identify the two b-jets and sorted by btag value for the background rejection cuts. 
	\item The last step of the top quark reconstruction is to associate one of the b-jets with the two light jets, which come from the hadronic $W^\pm$ decay.  One has two possibilities to combine the jets and one chooses the best combination by minimizing the following expression:
	\begin{equation}
	\label{formula:Chi2Top_3}
	d^2_{t} = (\frac{m_{cand}-m_{t}}{\sigma_{m_t}})^2 + (\frac{E_{cand}-E_{beam}}{\sigma_{E_{beam}}})^2+(\frac{p^*_b-68\,GeV}{\sigma_{p^*_b}})^2 + (\frac{\cos\theta_{bW}-0.23}{\sigma_{\cos\theta_{bW}}})^2,
	\end{equation}
	where $m_{cand}$ and $E_{cand}$ are the invariant mass and the energy of the top quark candidate, $m_t$ and $E_{beam}$ are the input top quark mass and the nominal beam energy of 250\,GeV, $p^*_b$ is the momentum of the b quarks in the top quark rest frame with nominal value of 68\,GeV and $\cos\theta_{bW}$ is the angle between the b quark and the $W^\pm$ boson with a nominal value of 0.23.
	\item The neutrino from leptonic $W^\pm$ boson decay is reconstructed using the recoil momentum method. The reconstructed neutrino is used to calculate the leptonic $W^\pm$ boson mass and leptonic top quark mass. 
\end{itemize}

The reconstructed distributions of the top quark and $W^\pm$ boson invariant masses are shown in Fig.~\ref{fig:TopWmass_3}. The values of the reconstructed peaks indicate the correct reconstruction flow. 

\begin{figure}[h]
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/top-w-mass-new.pdf}
		\caption{\sl Reconstructed invariant mass distributions of the hadronic top quark and hadronic $W^\pm$ boson decays.
		}
		\label{fig:TopWmass_3}
	}
	
\end{figure}

The $W^\pm$ boson kinematics and that of the b-quark in the \ttbar\ process depends strongly on the polarization of the initial state:
\begin{itemize}
	\item In case of a right-handed electron beam the events are enriched with right-handed top quarks. Due to the structure of the weak interaction, top quark decays into an energetic $W^\pm$ boson, which is emitted into top quark direction, and a relatively soft b-quark;
	\item In case of a left-handed electron beam the sample is enriched with the left-handed top quarks, which decay into soft $W^\pm$ bosons and energetic b-quarks, which are predominantly aligned with the top quark direction. 
\end{itemize}
An incorrect assignment of b-jet and $W^\pm$ jets compromises the top quark charge reconstruction needed for the top polar angle measurement. 

\subsection{Background processes}
The main background processes are summarized in Table~\ref{table:ttbarsigma}. 
The previous studies~\cite{bib:ILCTOP}\cite{bib:Doublet} have shown that the major backgrounds to the semileptonic \ttbar\ decay are the single top process and fully hadronic or fully leptonic \ttbar\ decays. 
%Several \sm\ processes give a rise to the six fermion final state, 
\input{ILD/tables/ttbar-sigma}

One can use the kinematical cuts to suppress the background processes, which were originally developed in ~\cite{bib:Doublet}[Jeremy] and defined in Table~\ref{table:ttbarselection}
\input{ILD/tables/ttbar-selection}
The prevoius studies demonstrated, that the purity of the full semileptonic \ttbar\ process selection is 91\% and final event selection efficiency is 54\%~\cite{bib:ILCTOP}.
The residual background is homogeneously distributed in $\cos\theta$, as it is shown in Fig.~\ref{fig:ILCTOPAFB}, which allows to concentrate our studies on the signal process only. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Results}

In this study, the top polar angle is calculated by using the reconstructed top or anti-top quark, which decayed hadronically.
In case of the reconstructed $\bar{t}$ quark, the polar angle is changed from $\theta_{\bar{t}} \to \theta_{t} + \pi$, or $\cos\theta_{\bar{t}} \to -\cos\theta_{t}$. 
%Hence, the main challange of the study is to correctly identify the charge of the reconstructed hadronic top or anti-top quark. 

The charge of the reconstructed top quark in this study is derived from three basic signatures: jet charge measurement using reconstructed secondary vertices or vertex charge, reconstructed kaon charge, and $W^\pm$ lepton charge. 
Top quark polar angle, reconstructed with the three basic methods is demonstrated in Fig.~\ref{fig:OneCharge_3}.
All three methods show a deviation between the reconstructed and generated distributions.
These deviations are a consequence of a significant charge impurity which leads to a confusion of a top quark with an anti-top quark.
%These charge migrations result in the divergence between the generated polar angle distribution and reconstructed curves for all three methods. 


\begin{figure}
	\centering
	\begin{subfigure}{0.33\textwidth}
		\includegraphics[clip, trim=0.1cm 0cm 13.9cm 0cm,width=0.99\textwidth]{ILD/plots/one-charge.pdf}
		\caption{\label{fig:OneCharge_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=6.78cm 0cm 7.3cm 0cm,width=0.99\textwidth]{ILD/plots/one-charge.pdf}
		\caption{\label{fig:OneCharge_b_3} }
	\end{subfigure}
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=13.6cm 0cm 0.4cm 0.cm,width=0.99\textwidth]{ILD/plots/one-charge.pdf}
		\caption{\label{fig:OneCharge_c_3} }
	\end{subfigure}
	\caption{\sl Generated polar angle distribution compared to reconstructed polar angle using standalone vertex charge (a), standalone kaon charge (b) and $W^\pm$ lepton charge(c). }
	
	\label{fig:OneCharge_3}
\end{figure}

The quality of the top quark polar angle reconstruction is estimated by the ratio of the reconstructed forward-backward asymmetry $A_{FB}^{rec}$ over the generated $A^{gen}_{FB}$ values.
For single vertex and kaon charge methods the $A_{FB}^{rec}/A^{gen}_{FB} \approx 63\%$, while for the $W^\pm$ lepton charge method is 74\% without any additional cuts. 
Hence, the standalone b-jet charges and $W^\pm$ lepton charge signatures are not reliable enough to compute the top quark polar angle and $A_{FB}$ precisely. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Charge combination}

To decrease this charge impurity, one uses the compatible combinations of two or more charge signatures.
In a semileptonic \ttbar\ event one has two b-jets with vertex and kaon charge signatures each and one $W^\pm$ lepton charge signature. 
%The general charge combination rules are:
One has the following charge combination rules to accept an event for the top quark polar angle measurement:
\begin{itemize}
	\item Two b-jets should have opposite both vertex and kaon charges;
	\item The kaon and vertex charge should have the same sign within one b-jet;
	\item The $W^\pm$ lepton charge should be opposite to the b-jet charges within one reconstructed top or anti-top quark decayed leptonically; 
	\item The  $W^\pm$ lepton charge should have the same charge as the b-jet charge from hadronically decayed top quark.
	\item The $W^\pm$ lepton charge can be used alone after cuts on the reconstructed top $\chi^2_{t}$.
\end{itemize}

According to these rules, one has the following charge pair signatures for a semileptonic \ttbar event:
\begin{itemize}
	\item Vertex charge from one b-jet in combination with vertex charge from another b-jet, abbreviated as {\sc vtx+vtx};
	\item Kaon charge from one b-jet in combination with kaon charge from another b-jet ({\sc kaon+kaon});
	\item Vertex charge and kaon charge combination from the same b-jet ({\sc vtx+kaon});
	\item Vertex charge and kaon charge combination from different b-jets ({\sc vtx+kaon'});
	\item  Vertex charge from a b-jet  in combination with $W^\pm$ lepton charge ({\sc l+vtx});
	\item  Kaon charge from a b-jet in combination with $W^\pm$ lepton charge ({\sc l+kaon});
	\item $W^\pm$ lepton charge after a $\chi^2_{t}$ cut  ({\sc l }cut).
\end{itemize}
Multiple reconstructed charge pair signatures are possible within one event.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Standalone jet charge application}
The concept of the b-jet charge measurement is validated by determining the top quark polar angle solely from the vertex and the kaon charges. 
%In this section, to prove the concept of the b-jet charge measurement, only the vertex charge and kaon charge combinations are used to compute the top polar angle. 
In case of the left-handed electron beam, the b-quarks are emitted into the direction of the initial top quark, which makes possible the standalone application the b-jet charge measurement. 

The vertex charge and kaon charge methods were used to compute top polar angle distribution shown in Fig.~\ref{fig:TopAsymmetryNoCutBjet_3}, where one sees a good agreement between the generated and reconstructed top polar angle histograms. 
The combined b-jet charge measurement shows a good precision on the asymmetry $A_{FB}^{rec}/A^{gen}_{FB} \approx 93\%$ with total efficiency of 16\%.
\begin{figure}
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/top-gamma.pdf}
		\caption{\sl Sum of the Lorentz gamma factors for leptonic and hadronic reconstructed tops separated into the wrongly and correctly reconstructed hadronic decay combinations.
		}
		\label{fig:TopGamma_3}
	}
	
\end{figure}

The most used method is the vertex charge and kaon charge combination from the same b-jet, as can be seen from Fig.~\ref{fig:TopAsymmetryNoCutBjet_b_3}, which is due to the chosen asymmetric cuts on the b-tag values. 
\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/top-asymmetry-bonly-gcut.pdf}
		\caption{\label{fig:TopAsymmetryNoCutBjet_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/top-methods-bonly-gcut.pdf}
		\caption{\label{fig:TopAsymmetryNoCutBjet_b_3} }
	\end{subfigure}
	\caption{\sl Generated polar angle distribution compared to reconstructed polar angle using charge signature combinations from b-jets only. }
	\label{fig:TopAsymmetryNoCutBjet_3}
\end{figure}

The sample in enriched by the good hadronic top quark combination using the cut $\gamma^{lep}_t + \gamma^{had}_t > 2.4$ as suggested by the histogram in Fig.~\ref{fig:TopGamma_3}, where Lorentz factor $\gamma_t = E_t / m_t$ depends on the reconstructed top quark energy $E_t$ and mass $m_t$.
To increase the vertex charge purity the following cuts are applied on the b-hadron kinematics in case of the vertex charge usage:
\begin{equation}
btag > 0.8\text{ and } |p|_{had} > 35\text{\,GeV}.
\end{equation}
One can use the purity distributions in Fig.~\ref{fig:RecoveryPurity_3} to optimize the cuts on the b-hadron kinematics. 
%One can purify the sample by changing the cuts on the b-hadron kinematics, but with a penalty on sample statistics. 

This result proves, that the  b-jet charge measurement can be used directly on the fully hadronic \ttbar\ decays for left-handed electron polarization, which will significantly increase the statistics needed for top coupling estimation. 

The vertex charge recovery increases the overall statistics by 7\% and the $A_{FB}^{rec}/A^{gen}_{FB}$ ratio by 4\%. 
However, the effects of the vertex charge recovery are much more essential for the $e^+e^-\to b\bar{b}$ process, discussed in Section~\ref{sec:BBBarresults}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Jet charge and lepton charge combination}
\label{sec:JetChargeCombo}
The events with $W^\pm$ lepton charge migration can be efficiently rejected using  a cut on $\chi^2_{top}$~[Jeremy], which is defined as:
\begin{equation}
	\label{formula:Chi2TopLepton_3}
	\chi^2_{top} = (\frac{\gamma_t^{had}-1.435}{\sigma_{\gamma_{t}}})^2 + (\frac{p^*_b-68}{\sigma_{\gamma_{p^*_b}}})^2 + (\frac{\cos\theta_{bW} - 0.23}{\sigma_{\cos\theta_{bW}}})^2,
\end{equation}
where $p^*_b$ and $\cos\theta_{bW}$ have been used in Eq.~\ref{formula:Chi2Top_3} and Lorentz factor $\gamma_t=E_{t}/m_{t}$ of the reconstructed top quark decayed hadronically. The $\chi^2_{top}$ is constructed to be minimal around the expectation values of the used variable distributions.
The distributions of the events with correctly assigned leptons and migrated leptons for all variables used in \ref{formula:Chi2TopLepton_3} are shown in Fig.~\ref{fig:TopChiVariables_3}.


\begin{figure}
	\centering
	\begin{subfigure}{0.33\textwidth}
		\includegraphics[clip, trim=0.1cm 0cm 13.9cm 0cm,width=0.99\textwidth]{ILD/plots/top-lepton-variables.pdf}
		\caption{\label{fig:TopChiVariables_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=6.78cm 0cm 7.3cm 0cm,width=0.99\textwidth]{ILD/plots/top-lepton-variables.pdf}
		\caption{\label{fig:TopChiVariables_b_3} }
	\end{subfigure}
	\begin{subfigure}{0.33\textwidth}
		\centering
		\includegraphics[clip, trim=13.6cm 0cm 0.4cm 0.cm,width=0.99\textwidth]{ILD/plots/top-lepton-variables.pdf}
		\caption{\label{fig:TopChiVariables_c_3} }
	\end{subfigure}
	\caption{\sl Distributions of $\gamma_t$ (a), $p^*_b$ (b) and $\cos\theta_{bW}$ (c) variables used for $W^\pm$ lepton charge reconstruction. The events are subdivided into correctly and incorrectly assigned lepton categories. }
	
	\label{fig:TopChiVariables_3}
\end{figure}


More than 93\% of the events with $\chi^2_{top} < 15$ have a correct combination of a b-jet with hadronic $W^\pm$, which propagates into a correct interpretation of the $W^\pm$ lepton charge.

The application of all possible pair combinations of the vertex charge, kaon charge and $W^\pm$ lepton charge to the top polar angle reconstruction shown in Fig.~\ref{fig:TopAsymmetryChi_a_3}. 


\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/top-asymmetry-lepton.pdf}
		\caption{\label{fig:TopAsymmetryChi_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/top-methods-lepton.pdf}
		\caption{\label{fig:TopAsymmetryChi_b_3} }
	\end{subfigure}
	\caption{\sl Generated polar angle distribution compared to reconstructed polar angle (a) using all possible charge signature combinations, plotted in (b). }
	\label{fig:TopAsymmetryChi_3}
\end{figure}

This method allows to reconstruct the top forward-backward asymmetry with $A_{FB}^{rec}/A^{gen}_{FB} = 94\%$ with the final efficiency of 38.6\%, which improves the previous result~\cite{bib:ILCTOP} by 25\%. 

The most used method is combination of the vertex charge with the $W^\pm$ lepton charge because the $W^\pm$ lepton is required to be reconstructed in every selected event. 
\subsubsection{Precision on top quark form factors }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Outlook}
As it was shown, the involvement of the b-jet charge measurement to semileptonic \ttbar pair decays significantly increases the statistics used for the top polar angle computation.
Besides the jet charge application, the statistics in the left-handed case can be largely increased by the reconstruction of the hadronic tau lepton decays, which were not used in present studies. 
Another way to reduce the charge migration effects is to involve the leptonic top quark decays in the top reconstruction, which can give a hint for correct top decay products association.

The jet charge measurement is a completely independent reconstruction tool, which allows to study the top decay kinematics and it allows to control the systematics effects.

The jet charge measurement is indispensable in case of the fully hadronic \ttbar\ decays, where there is no other sources of information on the top quark charge. 
In left-handed electron beam case, one directly applies the b-jet charge measurement, as it was done to produce the top quark polar angle distribution shown in Fig.~\ref{fig:TopAsymmetryNoCutBjet_3}. 
However, in the right-handed electron beam, the incorrect $W^\pm$ jets and b-jet association will lead to a significant distortion in the top polar angle distribution. Therefore, one should look for $W^\pm$ c-jet charge, using kaon charge, to control the top quark reconstruction quality. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Bottom quark production at the ILC}
%Motivation
The LEP measurement of the forward-backward asymmetry at the $Z^0$ pole resulted in 2.5$\sigma$ deviation from the \sm\ prediction, which can be an impact of a \bsm\ modification of the b-quark couplings to vector bosons.
The resolution of the LEP \afbb\ tension requires new level of experimental precision.
This is the main motivation of the $e^+e^-\to b\bar{b}$ studies at the $250$\,GeV stage of the ILC, which are presented in this chapter. 

The $e^+e^-\to b\bar{b}$ process has never been studied using the ILC environment. 
\subsection{Setup of the study}
In this studies the signal process is $e^+e^-\to b\bar{b}$ on the center-of-mass energy of 250\,GeV. 
A large statistics sample of integrated luminosity $L_{int}= 250$\,fb{$^{-1}$} is used for both polarizations in the ILD simulation environment. 
Same version of the event generators and the {\sc ilcsoft} distribution as for the \ttbar\ study are used.


\subsection{Bottom quark reconstruction and the background rejection}
The bottom quarks hadronize into two b-jets in the detector, that are reconstructed by jet clustering algorithm. %, which significantly simplifies the process reconstruction. 
\begin{figure}
	{\centering
		\includegraphics[clip, trim=0.cm 0cm 7.9cm 0cm, width=0.55\textwidth]{ILD/graphics/ild-bbbar.png}
		\caption{\sl Event display of the $e^+e^-\to b\bar{b}$ process in the ILD simulation.
		}
		\label{fig:BottomEvent_3}
	}
	
\end{figure}
%The \bbbar\ events are simply reconstructed as a simple two jet event, which are sorted by the b-tag value.
An example of the \bbbar\ pair event display in the ILD environment is shown in Fig.~\ref{fig:BottomEvent_3}. As one sees from the Table~\ref{table:bbbarselection}, the largest background contribution is coming from the \bbbar\ $Z^0$ return events, which is also true for the right-handed beam configuration, due to large $e^+e^-\to Z^0\gamma$ process cross section.

% Signal has high cross section -> but, background can distort polar angle spectrum, -> background levels >  cuts -> results 

The main challenge is to reject the background processes, which can distort the reconstructed polar angle spectrum of the b-quark. 
T1he most significant background processes are the so called $Z^0$ return background and the hadronic decays of diboson processes, like the hadronic decays of $e^+e^-\to Z^0Z^0$ or $e^+e^-\to Z^0H$ process. The process $e^+e^-\to W^\pm W^\mp$ has higher cross section than the signal, but the $W^\pm$ bosons have small branching ratio to the b-quark, hence, this process is easily rejected by b-tag cuts. 
The analysis benefits from the large production cross section, as compared to the background processes, as shown in Table~\ref{table:bbbarsigma}.

The $Z^0Z^0$ and $Z^0H$ pairs have large branching fractions to the b-quarks. 
As one sees from the Table~\ref{table:bbbarselection}, the largest background contribution is coming from the \bbbar\ $Z^0$ return events, which is also true for the right-handed beam configuration, due to large $e^+e^-\to Z^0\gamma$ process cross section.

The defined cuts against the background processes are the following:
\begin{itemize}
	\item Value of the first jet b-tag should be higher than 0.8 and b-tag of the second jets is higher 0.3;
	\item Invariant mass of two jets $m_{Inv} > 180$\,GeV and maximal photon energy $E^{max}_\gamma < 40$\,GeV;
	\item Sum of the jet masses $m^{jet}_1+m^{jet}_2<120$\,GeV;
%	\item Sphericity of the event, which is defined as $S_{I} = \sum p_i / E$, should be less than 0.2.
\end{itemize}
The sum of the jet masses is changing with the b-jet polar angle as shown in Fig.~\ref{fig:JetMasses_3}. This deviation happens due to the degrading jet energy resolution towards the forward region of the detector. 
\begin{figure}
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/mass-correction.pdf}
		\caption{\sl Mean sum of the jet masses as function of the polar angle of b-jets.   
		}
		\label{fig:JetMasses_3}
	}
	
\end{figure}
This behavior cause a bias in the b-quark polar angle distribution after the cut on  $m^{jet}_1+m^{jet}_2$ value. 
Thus, a polar angle correction was introduced to remove the $m^{jet}_1+m^{jet}_2$ dependence on the $|\cos\theta|$.
These cuts and the angular correction are applied equally to both beam polarizations.
The successive application of the preselection cuts is demonstrated in Table~\ref{table:bbbarselection}.

\input{ILD/tables/bbbar-sigma}

This signal selection technique  aimed at a very high purity, for the left-handed beam configuration the selection purity is 98.2\% and for the right-handed beam thefinal efficiency is the same 48\%, but the purity is decreased - 95\%, because of smaller signal cross section.

\input{ILD/tables/bbbar-selection}


\subsection{Results}
\label{sec:BBBarresults}
In these studies the same approach as for \ttbar\ polar angle computation is applied. In \bbbar\ process analysis, one has no other charge information sources available, except the b-jet information. 
Therefore, in this chapter, only the reconstructed vertex charge and kaon charge are computed and applied to the b-quark polar angle reconstruction. 

\subsubsection{Polar angle reconstruction}
In this section, the reconstruction of the signal process only is discussed using standard ILD reconstruction. %without application of vertex charge recovery algorithm.

The b-quark polar angle is computed as the vector difference polar angle of two b-jets after charge calculation. 
Figure~\ref{fig:BAsymmetryFirst_3} demonstrates reconstructed b-quark polar angle compared to the generated distribution for both beam polarizations. 
The generated $A_{FB}^{gen}$ values are:
\begin{equation}
	A_{FB}^{gen}(e^-_L e^+_R) = 0.705\text{ and }A_{FB}^{gen}(e^-_R e^+_L) = 0.26.
\end{equation} 
The difference in the generated b-quark polar angle distributions for two polarization configurations are caused by the different the $Z^0$ boson couplings to the left-handed and the right-handed fermions. 

\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-norec-nocorr-nobkg-left.pdf}
		\caption{\label{fig:BAsymmetryFirst_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
			\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-norec-nocorr-nobkg-right.pdf}
		\caption{\label{fig:BAsymmetryFirst_b_3} }
	\end{subfigure}
	\caption{\sl Generated b-quark polar angle distribution compared to reconstructed polar angle in left-handed case (a) and right-handed case (b) using all possible charge signature combinations. Integrated luminosity used 250\ifb for both polarizations. }
	\label{fig:BAsymmetryFirst_3}
\end{figure}
%Both polarizations
The reconstructed b-quark polar angle distributions have two major problems:
\begin{itemize}
	\item The residual charge impurity contaminates the backward region $\cos\theta < 0$ of both distributions in Fig.~\ref{fig:BAsymmetryFirst_3}. Due to the strong b-quark production asymmetry in the left-handed case the backward region is contaminated entirely by the events with misreconstructed b-jet charge as seen in Fig.~\ref{fig:BAsymmetryProblem_a_3}.
	\item The large efficiency decrease in the forward region $|\cos\theta| > 0.85$. The main reason of this decrease is the inefficiency of the vertexing algorithms, which tend to not find any reconstructed vertex in the forward region, as seen in Fig.~\ref{fig:MissedCos_3}. The zoom into the problematic region is shown in Fig.~\ref{fig:BAsymmetryProblem_b_3};

\end{itemize}


\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-zoom-contamination.pdf}
		\caption{\label{fig:BAsymmetryProblem_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-zoom-inefficiency.pdf}
		\caption{\label{fig:BAsymmetryProblem_b_3} }
	\end{subfigure}
	\caption{\sl The demonstration of the contamination of backward region by the events with misreconstructed charge (a) and the forward region inefficiency of the b-quark polar angle measurements (b). }
	\label{fig:BAsymmetryProblem_3}
\end{figure}

The  inefficiency in the forward region of the detector makes impossible the measurement of the $A_{FB}^b$ using a simple counting method. 
%This problem can be avoided by the fitting the unaffected central bins with a function and extrapolating the fitted function on the full polar angle range $(-1,1)$. 
Thus, the b-quark polar angle analysis limited to the region of $|\cos\theta| < 0.85$.
The polar angle histogram is fitted by the general differential cross section function:
\begin{equation}
	f(A,B) = A(1+\cos^2\theta) + B \cos\theta, %+ C \sin^2\theta,
	\label{formula:PolarAngleFit_3}
\end{equation}
where $A$ and $B$ are the fitted parameters. 
The parameter $A$ is proportional to the total cross section, while $B$ is proportional to the forward-backward asymmetry.
After the fit, the function is extrapolated to the full polar angle spectrum.
However, the sensitivity of the current ILD experiment configuration to New Physics effects is lost for $|\cos\theta| > 0.85$.

Using the extracted polar angle function the reconstructed $A_{FB}^b$ value is calculated as
\begin{eqnarray}
	A_{FB} = \frac{3}{4}\frac{B}{2 A}.
\end{eqnarray} 
The precision of the $A_{FB}^b$ reconstruction is $A_{FB}^{rec}/A^{gen}_{FB} = 88\%$ in left-handed case and  $A_{FB}^{rec}/A^{gen}_{FB} = 89\%$ in the right-handed case.  
However, the backward region contamination problem requires large corrections for residual charge misreconstruction in the left-handed polarization case as compared to the right-handed polarization case. 

The method of b-quark polar angle correction should be independent from the generated curve. 

\subsubsection{Vertex Charge Recovery influence}

The vertex charge recovery algorithm, described in Section~\ref{sec:VtxRecovery}, is applied to the b-quark polar angle measurement in attempt to decrease the discrepancies between generated and reconstructed distributions.
The result of the recovery application is shown in Fig.~\ref{fig:BAsymmetryRec_3}.
\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-rec-nocorr-nobkg-left.pdf}
		\caption{\label{fig:BAsymmetryRec_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-rec-nocorr-nobkg-right.pdf}
		\caption{\label{fig:BAsymmetryRec_b_3} }
	\end{subfigure}
	\caption{\sl Generated b-quark polar angle distribution compared to reconstructed polar angle in left-handed case (a) and right-handed case (b) using the independent kaon and vertex charge combinations after application of the vertex charge recovery algorithm. }
	\label{fig:BAsymmetryRec_3}
\end{figure}
The main improvements of the vertex charge recovery are the following:
\begin{itemize}
	\item The number of accepted events is improved by 9\%;
	\item The $A_{FB}$ reconstruction is improved before correction by 3\%;
	\item The vertex charge purity is increased by 4\%;
	\item The kaon charge purity stays the same, but the number of kaons is increased by 10\%; 
	\item The vertex charge recovery provides close to constant charge purity in the barrel region of the ILD experiment, as can be seen in Fig.~\ref{fig:BAsymmetryRecZ_3}. This is the consequence of the recovery of the peaks of missing vertex particles as it is described in Sec.~\ref{sec:VtxRecovery}.
	The residual efficiency decrease in the $|\cos\theta|\approx 0.8$ bin is caused by the jet energy resolution decrease.  
\end{itemize}

\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/zoom-rec.pdf}
		\caption{\label{fig:BAsymmetryRecZ_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/zoom-norec.pdf}
		\caption{\label{fig:BAsymmetryRecZ_b_3} }
	\end{subfigure}
	\caption{\sl The demonstration of the vertex charge recovery improvement (a) compared to the standard algorithm (b). }
	\label{fig:BAsymmetryRecZ_3}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Make sure no generated quantity used
\subsubsection{Charge purity measurement}
\label{sec:ChargePurity}
The knowledge of the charge purity from the reconstructed events, or the future ILC data is crucial for the present analysis. 
%The adopted system of the
The measurement of the b-jet charge purity is done using the number of accepted events $N_a$ and the number of rejected events $N_r$. 
The b-jet charge measurement uses two compatible charge combinations, either the vertex charge or the kaon charge.
 Which means, that the following rules are applied:
\begin{itemize}
	\item To accept an event one need to measure both charges correctly, or both charges incorrectly;
	\item The rejected event has one charge correctly reconstructed and another incorrectly reconstructed. 
\end{itemize}

Let $p$ be a probability of correct charge measurement or the charge purity, then $q = 1-p$ is a probability of the incorrect charge measurement. 
%Suppose, one has $N$ events, which is a sum of accepted event number $N_a$ and rejected event number $N_r$. 
Then, the number of accepted events is:
\begin{equation}
	N_a = N p^2 + N q^2,
	\label{formula:PurityA_3}
\end{equation}
while the number of rejected has the following expression:
\begin{equation}
	N_r = 2N pq,
	\label{formula:PurityR_3}
\end{equation}
where $N = N_a + N_r$ is the total number of events.
The charge purity $p$ is easily computed using expressions (\ref{formula:PurityA_3}) and (\ref{formula:PurityR_3}) for each charge pair combinations.

The charge purity values are the following:
\begin{itemize}
	\item Vertex-vertex charge combination - 80\%;
	\item Kaon-kaon charge combination  - 79\%;
	\item Kaon-vertex charge combination from the same jet - 90\%;
	\item Kaon-vertex charge combination from opposite jets - 77\%.
\end{itemize}
The kaon-vertex combination have much higher value of the charge purity than the vertex-vertex and kaon-kaon combinations. 
The reconstruction algorithms can by accident lose a particle from the reconstructed secondary or tertiary vertices. 
Thus, the true $B_0$ hadron will be reconstructed as a falsely charged hadron.
The $B^0-\bar{B}^0$ oscillations can flip the charge of the $K$-meson, which will create a fake compatibility between the kaon and vertex charges.
Hence, the measured purity of the kaon-vertex charge combination is falsely increased by the accidental kaon-vertex charge correlation.
%This is caused by charge correlations induced by the $B^0-\bar{B}^0$ oscillations. 
Therefore, to avoid the charge correlations, the b-quark polar  angle and the corrections to the polar angle are calculated without the mixed charge combinations.

Again, the main advantage of this charge purity measurement procedure is its independence from the generator information. 
Therefore, it can be directly applied to the future data, taken by the ILC.
%Therefore, the vertex and kaon charge purity values can be computed from the data, which allows to control the vertexing algorithms performance from the data. 


\subsubsection{Corrections to the polar angle}
To resolve the discrepancy between the generated and the reconstructed polar angle distributions, shown in Fig.~\ref{fig:BAsymmetryProblem_a_3}, the polar angle spectrum is corrected using the measured purity $p$.
Knowing the charge purity from the reconstruction, 
To compute the correction, one defines the number of the accepted events in the forward region $N_a^+$ and in the backward region $N_a^-$ 
\begin{equation}
\begin{array}{l}
N_a^+ =  N^+_{true}p^2 + N^-_{true}q^2\\
N_a^- =  N^-_{true}p^2 + N^+_{true}q^2,
\end{array}
\label{formula:Correction_3}
\end{equation}
where $N_{true}^+$ and  $N_{true}^-$ are the true accepted event number the forward region and in the backward region, respectively.
The terms proportional to $q^2$ are responsible for the contamination effect shown in Fig.~\ref{fig:BAsymmetryProblem_a_3}.
The equation (\ref{formula:Correction_3}) is true for forward and backward bins in the b-quark polar angle histogram.
%This computation is carried out for each bin of the b-quark polar angle histogram. 

To simplify the procedure, the purity $p$ is calculated as an average for all bins of the polar angle histogram and charge pair combinations. 

%One calculates the correction to the polar angle using expression (\ref{formula:Correction_3}). 

The results after the application of the corrections for the charge impurity are shown in Fig.~\ref{fig:BAsymmetryCorrected_3}. 
The precision of the $A_{FB}^b$ reconstruction is $A_{FB}^{rec}/A^{gen}_{FB} = 100.4\%\pm 0.2\%$ in left-handed case and  $A_{FB}^{rec}/A^{gen}_{FB} = 104\%\pm2.0\%$ in the right-handed case. 
The errors on the $A_{FB}^{rec}$ are calculated using the fit uncertainties. 

\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-rec-corr-nobkg-left.pdf}
		\caption{\label{fig:BAsymmetryCorrected_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
			\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-rec-corr-nobkg-right.pdf}
		\caption{\label{fig:BAsymmetryCorrected_b_3} }
	\end{subfigure}
	\caption{\sl Generated b-quark polar angle distribution compared to reconstructed polar angle in left-handed case (a) and right-handed case (b) using the independent kaon and vertex charge combinations. The reconstructed distribution before correction is in black, corrected for the charge impurity is in blue color. }
	\label{fig:BAsymmetryCorrected_3}
\end{figure}

The data-driven charge purity measurement and the polar angle correction algorithm have been proven to work with the different vertexing algorithms. 
The corrected b-quark polar angle distributions with the overlaid background processes after vertex recovery are shown in Fig.~\ref{fig:BAsymmetryFinal_3}.
\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-final-left.pdf}
		\caption{\label{fig:BAsymmetryFinal_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.95\textwidth]{ILD/plots/basymmetry-final-right.pdf}
		\caption{\label{fig:BAsymmetryFinal_b_3} }
	\end{subfigure}
	\caption{\sl Generated b-quark polar angle distribution compared to the reconstructed b-quarks polar angle in left-handed case (a) and right-handed case (b) using the independent kaon and vertex charge combinations. The reconstructed distribution before correction is in black, corrected for the charge impurity is in blue color. }
	\label{fig:BAsymmetryFinal_3}
\end{figure}
The background distribution is fitted with the polinomial function, which is substructed from the overlaid signal and background distributions. 
The final result of the $A_{FB}^b$ measurement is for the integrated luminosity of 250\ifb for both ideal beam polarizations:
\begin{equation}
A_{FB}^{rec}(e^-_L e^+_R) = 0.708\pm0.0026 \text{ and }A_{FB}^{gen}(e^-_R e^+_L) =  0.275\pm 0.0061.
\end{equation}
This result needs to be scaled to the realisitic beam polarization and the runing scenarious at the ILC.
\subsection{Reachable accuracies at the ILC}
The traditional method of the $Z^0$ coupling calculation requires an estimation of the uncertainties on the total cross section and the forward-backward asymmetry values. 
The calculated uncertainties should correspond to the realistic running conditions at the ILC.

The cross section measurement requires the high purity and the high efficiency signal selection against the background processes to minimize the statistical error and supress the background systematic effects. 
The best value selection efficiency for the left-handed beam polarization is 40\% and 33\% for the right-handed beam polarization with the purity of more than 97\% for both beam configurations. 


The ILC running scenarios are described in~\cite{bib:H20}. The  preferred running option is H~20, which has the following parameters:
\begin{itemize}
	\item The first $\sqrt{s}=$250\,GeV will collect 500\ifb\ total integrated luminosity;
	\item The luminosity sharing between the two polarizations is 67.5\% for the left-handed beam configuration and 22.5\% for the right-handed beam configuration;
	\item The electron beam can be polarized up to $\pm$80\% and the positron beam - up to $\pm$30\%.
\end{itemize}
The realistic running conditions increase the statistical errors by a factor of 1.12 for the left-handed beam and a factor of 1.75 for the right-handed beam configuration. 

The final uncertainties on the measured total cross section and the forward-backward asymmetry values for the first $\sqrt{s}=$250\,GeV run of the ILC are displayed in Table~\ref{table:bbbarfinal}. These unceratinties are used to calculate the precision on the b-quark electroweak couplings and the b-quark electroweak form factor values.
\input{ILD/tables/bbbar-final}
\subsection{Comparison to the LEP results}

The ILC is able to provide a definite solution to the LEP tension of the $A_{FB}^b$ measurement with the \sm\ prediction.
% The LEP measurement on the $Z^0$ pole is still the most precise b-quark $A_{FB}$ measurement.


The b-quark forward-backward asymmetry $A_{FB}$ for the tree-level \sm\ as function of the center-of-mass energy along with the experimental results are demonstrated in Fig.~\ref{fig:LEPILC_3}. 
The most precise $A_{FB}$ measurement was carried out at $Z^0$ pole by LEP~I experiments. 
The ILC will be able to measure the $A_{FB}$ and the b-quark cross section for two different initial state polarizations, shown in  Fig.~\ref{fig:LEPILC_3}. 
These different measurements can be only compared by the final precision on the b-quark to $Z^0$ couplings, while other b-quark couplings or form factors are assumed to have fixed \sm\ values. 
%In this thesis, the expected results of the ILC are compared to the LEP~I measurements of the $A_{FB}$ and the $R_b$ values.
\begin{figure}
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/afb-sqrts.pdf}
		\caption{\sl Tree level \sm\ forward-backward asymmetry $A_{FB}$ as function of center-of-mass energy $\sqrt{s}$.  Results of the low-energy experiments and LEP measurements are taken from~\cite{bib:LEPpuzzle}. 
		}
		\label{fig:LEPILC_3}
	}
	
\end{figure}
The numerical study of the LEP~I measurements was done to compute the LEP precision on the b-quark couplings. 
The $\pm$1\,$\sigma$ regions for the $A_{FB}$ and $R_b$ measurements at $Z^0$ pole are shown in Fig.~\ref{fig:LEPILCResult_a_3}.
The intersection of the error bands gives the relative precision on the $Z^0 b\bar{b}$ couplings.
This numerical result is obtained by scanning the parameter space of the left-handed $g^Z_L$ and the right-handed $Z^0b\bar{b}$ coupling $g^Z_R$ defined in \ref{formula:EWcouplings_3}, assuming uncorrelated measurements of $A_{FB}$ and $R_b$ values at LEP. 
\begin{figure}
	{\centering
		\includegraphics[width=0.55\textwidth]{ILD/plots/lep-result-full.pdf}
		\caption{\sl  Tree level $\pm$1\,$\sigma$ allowed regions defined by the forward-backward asymmetry and $R_b$ measurements at LEP~I. Allowed values are represented by the intersections of uncertainty bands. The LEP measurements are taken from~\cite{bib:LEPpuzzle}. 
		}
		\label{fig:LEPResultFull_3}
	}
	
\end{figure}
This study leads to the following conclusions:
\begin{itemize}
	\item The value $g_R^Z$ has much larger uncertainty of $\pm$9.6\% as compared to the $\pm 1$\% uncertainty on the $g_L^Z$ coupling;
	\item The $g_R^Z$ is shifted w.r.t. the \sm\ value at $(0,0)$ by approximately $2.5\,\sigma$;
	\item The LEP~I measurements at $Z^0$ pole had no interference between $Z^0$ and $\gamma$ propagators, which leads to the sign ambiguity of the $g_R^Z$ coupling. This fact is reflected in Fig.~\ref{fig:LEPResultFull_3} as a second allowed region around $\delta g_R^Z / g_R^Z \approx -2.25$. 
\end{itemize}
The LEP measurements allow for a sign flip of the right-handed coupling $g_R^Z$, however, it will produce 2\,$\sigma$ tension with TRISTAN data at 60\,GeV, as found in~\cite{bib:LEPpuzzle}.
The $g_R^Z$ sign flip is easily detectable at the ILC, because the b-polar angle in right-handed beam configuration in Fig.~\ref{fig:BAsymmetryFinal_b_3} will be reflected around $\cos\theta_b = 0$. 
Therefore, the further studies are concentrated on the solution with the \sm\ $g_R^Z$ coupling sign. 
The corresponding parameter space is shown in Fig.~\ref{fig:LEPILCResult_a_3}.
The estimated  central values of the $Z^0b\bar{b}$ couplings obtained at LEP are
\begin{eqnarray}
	\delta g_R^Z / g_R^Z = +25.4\% \pm 9.7\% \label{formula:LEPgR} \\
	\delta  g_L^Z / g_L^Z = -0.9\% \pm 0.4\%.
\end{eqnarray}


The precision b-quark couplings at the ILC are estimated by the b-quark polar angle fit by the differential cross section function~\ref{formula:PolarAngleFit_3}.
The extracted fit parameters $A^I$ and $B^I$ and the corresponding covariance matrix for two beam polarizations allow to calculate the $Z^0b\bar{b}$ couplings with the corresponding uncertainties. 
The ILC will provide only one definite solution, due to the $Z^0/\gamma$ interference terms in the differential cross section definition. 

The values of the differential cross section parameters $A^I$ and $B^I$ from Table~\ref{table:bbbarfinal} are used to estimate the corresponding $\pm1\,\sigma$ error bands for both beam polarizations in Fig.~\ref{fig:LEPILCResult_b_3}.
The numerical calculation agrees with an analytical estimation of the relative uncertainties on the following values:
\begin{eqnarray}
	\delta g_R^Z / g_R^Z = \pm 2.1\% \label{formula:ILCgR} \\
	\delta  g_L^Z / g_L^Z = \pm 0.2\%,
\end{eqnarray}
which are achievable after the first $\sqrt{s} = 250$\,GeV physics run of the ILC. 


\begin{figure}
	\centering
	\begin{subfigure}{0.5\textwidth}
		\includegraphics[width=0.99\textwidth]{ILD/plots/lep-result-zoom.pdf}
		\caption{\label{fig:LEPILCResult_a_3} }
	\end{subfigure}% 
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.99\textwidth]{ILD/plots/ilc-result.pdf}
		\caption{\label{fig:LEPILCResult_b_3} }
	\end{subfigure}
	\caption{\sl Tree level $\pm 1\,\sigma$ allowed regions defined by the forward-backward asymmetry and total cross section measurements at LEP (a) and ILC via the differential cross section fit (b). Dashed guidelines show the \sm\ value.}
	\label{fig:LEPILCResult_3}
\end{figure}


Therefore, the ILC will be able to provide 5\,$\sigma$ deviation for a $\pm$11\% modification of the $g_R^Z$ coupling after the first 250\,GeV physics run.



\subsection{Precision on the b-quark form factors}
%At the ILC, it will be possible to make an independent calculation of all b-quark form factors using the reconstructed b-quark polar angle.
%The reconstructed b-quark polar angle is described by the differential cross section of the \bbbar\ pair production in Eq.~\ref{formula:DiffSigma_3}.




\subsection{Outlook}
\section*{Conclusions}
